#!/usr/bin/perl -s

################################################################
#   Program:    Customer Email Contact Portal                  #
#   Author:     Luis Gustavo Rodriguez (drlouie)               #
#   Copyright:  (c) 2016 Luis G. Rodriguez                     #
#   Licensing:  MIT License                                    #
#   About                                                      #
#        Type:  Email form with many website centric features. #
##################################################################################
# Permission is hereby granted, free of charge, to any person obtaining a copy   #
# of this software and associated documentation files (the "Software"), to deal  #
# in the Software without restriction, including without limitation the rights   #
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell      #
# copies of the Software, and to permit persons to whom the Software is          #
# furnished to do so, subject to the following conditions:                       #
#                                                                                #
# The above copyright notice and this permission notice shall be included in all #
# copies or substantial portions of the Software.                                #
#                                                                                #
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR     #
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,       #
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE    #
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER         #
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,  #
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  #
# SOFTWARE.                                                                      #
##################################################################################

$perlCompileOS = $^O;
if ($perlCompileOS =~ m/Win/i) {
	$HTTPRoot = 'H:/dvwf/rbsd_IO/vhosts/vsnet/htdocsNEW/';
}
else { $HTTPRoot = '/var/www/vps-net.com/htdocs/'; }

###############
##<-- 2k10 -->##
###############

$|=1;

$noDateParse = 1;
require($HTTPRoot."dateNewest.nsp");

require($HTTPRoot."q.nsp");

## --> Snif cookie, if present test for logged in status
require ($HTTPRoot."cookiesnif.nsp");

##--power functions
require($HTTPRoot."vfunc.nsp");




##--
##-- COMMMUNICATION: FORM  (AJAX ASSISTED)
##--


$template = $FORM{'t'};
$version = $FORM{'v'};
$xit = $FORM{'x'};
if (($template && ($template =~ m/[^a-zA-Z0-9]/))
|| ($version && ($version =~ m/[^0-9]/))
|| ($xit && ($xit =~ m/[^0-9]/))
){
	##--> Hack attempt / or bad input
	print "Cache-Control: must-revalidate\n\n";
	print "<script language=\"Javascript\" type=\"text/javascript\">alert('Error 2150: It is advisable you take note of this error and report it to the site administrator. Thanks.');if (!(!parent.activeTemplates)) { parent.\$.fancybox.close(); } else { document.location.href = '/'; }</script>";
	exit;
}

	
	###-- setup OpenCanvas package params
	#- Price
	#-$OCPrices = "529.75|942.60|1,475.00";
	#- No Price
	$OCPrices = "||";
	@allCanvasPrices = split(/\|/, $OCPrices);
	$OCv1Price = '$'.$allCanvasPrices[0];
	$OCv2Price = '$'.$allCanvasPrices[1];
	$OCv3Price = '$'.$allCanvasPrices[2];
	push(@losCanvasPacks,"");
	#- Price
	#- push(@losCanvasPacks,"OpenCanvas eXpress [$OCv1Price]");
	#- push(@losCanvasPacks,"OpenCanvas Business [$OCv2Price]");
	#- push(@losCanvasPacks,"OpenCanvas Advanced [$OCv3Price]");	
	#- No Price
	push(@losCanvasPacks,"OpenCanvas eXpress");
	push(@losCanvasPacks,"OpenCanvas Business");
	push(@losCanvasPacks,"OpenCanvas Advanced");	

	$elTitulo = 'Request Error!';

	##-- 
	##-- defeat warnings [Use of uninitialized value]
	##-- 
	if (!$template) { $template = ""; }
	if (!$version) { $version = ""; }
	$TN = "";
	$trueTN = "";
	$feedbackCSS = "";
	$myact = "";
	$myactstate = "";
	$cualScript = "";
	$losCategories = "";
	$processingScript = "";
	$closingScript = "";

##-- reset our action state
if($Todo_Form[0]) {
	@myactstate = split(/-----/,$Todo_Form[0]);
	$myactstate = $myactstate[1];
	$myact = $myactstate[0];
}

$MYCLOSER = "parent.\$.fancybox.close();";
$MYCLOSER2 = "parent.location.href = '/';";
if (($FORM{'outcall'} && (int($FORM{'outcall'})==1))) {
	$MYCLOSER = "history.go(-1);";
	$MYCLOSER2 = $MYCLOSER;
}

##-- customer service
if ($FORM{'service'} eq "1" && $FORM{'INTERNAL'} eq "1") {
	$ISINTERNAL = 1;
	$ISSERVICE = 1;
	$elTitulo = 'Contact Us';
	$feedback = 'Your questions and feedback are always welcome:';
	$cancelAction = 'Cancel';
	$cancelAct = 'Canceling';
	$closeAct = $MYCLOSER;
	$submitAct = 'Submit Message';
	$submitActive = 'Processing';
	
	##-- $processingScript - dynamic form submission script
	$processingScript = "else if (action == 'Processing') { document.VirtualPrivateComment.x.value = '2'; doUnload(); document.getElementById(\"VirtualPrivateActivity\").innerHTML = loadImage; return true; }";
}

$headerPrinted = 0;
##-- logged in, force state
if ($myact eq "" &&  $ISIN ne "") {
	$myactstate = '1';
	$myact = 'service';

	$elTitulo = 'Contact Us';
	$feedback = 'Your questions and feedback are always welcome:';
	$cancelAction = 'Cancel';
	$cancelAct = 'Canceling';
	$closeAct = $MYCLOSER;
	$submitAct = 'Submit Message';
	$submitActive = 'Processing';
	
	##-- $processingScript - dynamic form submission script
	$processingScript = "else if (action == 'Processing') { document.VirtualPrivateComment.x.value = '2'; doUnload(); document.getElementById(\"VirtualPrivateActivity\").innerHTML = loadImage; return true; }";

	##-- associative UID = OpenCanvasDesign ID (Cart) [IF EXISTS]
	if ($OpenCanvasDesign  && ($OpenCanvasDesign ne "" && $OpenCanvasDesign ne " ")) { 
		##-- if exists, we can checked history against it
		$inUID = $OpenCanvasDesign; 
	}
	##-- no OpenCanvas cookie [UID] present, lets hook one up
	##-- $inUID is generated
	##-- if successful, cookie placed, header printed and returned as such
	else { $headerPrinted = &bakeMyCanvasCartCookie; }
	
	if ($headerPrinted != 0) {
		print "<script>location.href=''+location.href+'';</script>";
	}
}


##-- start fresh
$cartID = 0;
$trueIP = 0;
$CualOC = 0;

##-- user status bar template (top-right corner)
$userStatusBar = "<div id=\"UserStatus\" class=\"activeUserData\" style=\"position:absolute;right:8px;top:3px;z-index:100;\"><nobr>%%USERSTATUS%%</nobr></div>";

##-- set default bar
$myUserStatus = "";

##--
##-- COMMMUNICATION: INLINE (FULL-TIME AJAX)
##--


##-- ajax inline form mailer, check email, then have client push the Q via POST
## - qifm = QuickInlineFormMailer
if (!(!$FORM{'qifm'})){
	
	$qifm = $FORM{'AAEEmail'};
	$em = $qifm;
	$n = $FORM{'AAEFirst'};
	$nx = $FORM{'AAELast'};
	$q = $FORM{'AskAnExpert'};
	$FirstFailed = 1; 
	$LastFailed = 1;
	$EmailFailed = 1;
	$headerPrinted = 0;
	$requestOPTIN = 1;
	##-- first/last name asynchronous checking
	$FirstFailed = &checkName($n,'First','first name');
	if ($FirstFailed == 0) { $LastFailed = &checkName($nx,'Last','last name'); }

	if ($FirstFailed == 0 && $LastFailed == 0) {
		if (length($qifm) >= 5 && !(lc($qifm) =~ "e-mail address")) {
			$EmailFailed = &checkNewEmail;
			##--email good
			if ($EmailFailed == 0) {
				if (length($q) >= 10 && !(lc($q) =~ "how may our expert technical or friendly support staff be of assistance?")) { 
					$newCom = &HTMLencodeMyInput($q);

					##-- associative UID = OpenCanvasDesign ID (Cart) [IF EXISTS]
					if ($OpenCanvasDesign  && ($OpenCanvasDesign ne "" && $OpenCanvasDesign ne " ")) { 
						##-- if exists, we can checked history against it
						$inUID = $OpenCanvasDesign; 
						#-- check to see if user has already opted-in for this type of mailer
						$requestOPTIN = &checkOptIns("EntryType='AskAnExpert-OptIn'","},{e:$qifm},{optin:Yes}");
					}
					##-- no OpenCanvas cookie [UID] present, lets hook one up
					##-- $inUID is generated
					##-- if successful, cookie placed, header printed and returned as such
					else { $headerPrinted = &bakeMyCanvasCartCookie; }

					&sendVirtualPrivateMessage($inUID,"AskAnExpert","{f:$n},{l:$nx},{e:$qifm},{m:$newCom}");
					
					if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }

					##-- 
					##-- AJAX: result processor relies on this being this EXACT phrases: [Message sent.] OR [Message Sent]
					##-- 

					##-- ASK USER to opt-in: Message sent.
					if ($requestOPTIN == 1) { print "Message sent."; }

					##-- USER ALREADY OPTED-IN for this type of communication
					##-- ONLY tell of message success: Message Sent
					else { print "Message Sent"; }
				}
				else {
					if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
					if (length($q) >= 10) { print "Your message was rejected based on its perceived content, please rephrase your question."; } 
					else { print "Your message is too short, it must be at least 10 characters long."; } 
				}
			}
			##--email fail
			else { if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; } print $whyNewTry; }
		}
		else {
			if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
			if (length($qifm) >= 5) { print 'Your email address is invalid, please try again.'; }
			else { print 'Your email address is missing or incomplete.'; }
		}
	}
	else {
		if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
		##-- bad first/last name [in-sequence]
		print $whyNewTry
		#if ($FirstFailed == 1) { print $whyNewTry; }
		#else { print $whyNewTry; }
	}
	exit;
}




## - optin = CommunicationsOptIn
## - ajax on this one simply spit back message, client won't do anything with results anyway (silent)
if (!(!$FORM{'optin'})){
	$n = $FORM{'AAEFirst'};
	$nx = $FORM{'AAELast'};
	$q = $FORM{'AskAnExpert'};
	$optin = $FORM{'AAEEmail'};
	$em = $optin;
	$EmailFailed = 1;
	$EmailFailed = &checkNewEmail;
	if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
	if ($EmailFailed == 0) {

		##-- associative UID = OpenCanvasDesign ID (Cart) [IF EXISTS]
		if ($OpenCanvasDesign  && ($OpenCanvasDesign ne "" && $OpenCanvasDesign ne " ")) { $inUID = $OpenCanvasDesign; }
		
		use DBI;
		my $dbh = DBI->connect("DBI:mysql:vpsnetcom","vpsnetcom","YOUR-MySQL-PASSWORD") or die "No data access: <b>VPS-NET</b>\n"; 
		$dbh->{RaiseError} = 1; 

		##-- save comments to db, clear the form
		##-- we dont save CartID here, for we are not in cart mode ATM, meaning this comment(question) not coming from cart source (example: aae)
		my $sth = $dbh->prepare("INSERT INTO ConversationLog (LineID, EntryType, MessageContext, CreationDate, UID) VALUES (Null, 'AskAnExpert-OptIn', '{f:$n},{l:$nx},{e:$optin},{optin:Yes}', '$datetime', '$inUID')");
		$sth->execute or die "Unable to execute query\n";
		$sth->finish;

		$dbh->disconnect;
		
		
		##<MUST-INTERNET-TEST>##
		## ----------------------->>> SEND AAE EMAIL
		## ----------------------->>> PREPARE VARIABLES FOR OUTER SEND EMAIL PROGRAM
		my $OGSenderIn = "$em ( $n $nx )";
		my $OGRecipientIn = "Virtual Private Servers and Networks<askanexpert\@vps-net.com>";
		my $OGsubject = "Ask An Expert";

		$myEmailBody = &getEmailHTML(2,1,"Virtual Private - Ask An Expert","","$OGsubject","<strong>Concerned,</strong><br><br>The VPS-NET 'Ask An Expert' form was used by submit the following question:<br><br><fieldset><legend><div>$n $nx</div></legend><div>$q</div></fieldset>","");

		use lib "/usr/local/lib/";
		use MIME::Lite;
		my $msg = MIME::Lite->new(
							From    =>$OGSenderIn,
		                	To      =>$OGRecipientIn,
    	 		        	Subject =>$OGsubject,
		                	Type    =>'multipart/related'
	     					);
	   	$msg->attach(Type => 'text/html', Data => $myEmailBody);
		$msg->send();

		##-- ajax processed this feedback silently
		print "Done!";

	}
	exit;
}






##-- user unlogged, therefore we ajax request for email and first name before finally sending-message/sharing 
##-- this is that ajax'd request
##-- ocso = VirtualPrivateSelectorOutput [select list: topic currently selected] || ss = SubjectSelection [all topics selected] || vps = user submited message contents
##-- ocso = selectedStack WHEREAS VirtualPrivateSelectorOutput = option selected at time of submission
$ocso = $FORM{'ocso'};
$ss = $FORM{'SubjectSelection'};
$OCSO = $FORM{'VirtualPrivateSelectorOutput'};
##--EmailConsent
$ec = $FORM{'ec'};
#--if (($ocso && (!$ocso =~ m/[^a-zA-Z0-9-\(\)]/))|| ($ss && (!$ss =~ m/[^a-zA-Z0-9-\(\)]/))){
if (!(!$FORM{'ocso'}) && (int($ocso) == 1)){

	$EmailAddressFailed = 1;
	$requestOPTIN = 1;

	##--hasn't selected an item (universal)
	if ($OCSO eq "Specific Products or Services..." || $OCSO eq "Specific Products, Services or Content...") {
		if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }

		##-- AJAX keys: another+selection
		if ($FORM{'share'} && (int($FORM{'share'})==1)) {
			print "Can't share &quot;Specific Products, Services or Content...&quot;, make a selection."; 
		}else {
			print "&quot;Specific Products or Services...&quot; is invalid, please make another selection."; 
		}

		exit;
	}

	if ($FORM{'share'} && (int($FORM{'share'})==1)) {


		$q = $FORM{'VirtualPrivateComments'};
		if (length($q) >= 5) {
			$recipientEmailAddresses = $q;
			$recipientEmailAddresses =~ s/ //gi;
			$EmailAddressFailed = &checkMultipleEmails($recipientEmailAddresses);
			if ($EmailAddressFailed == 0) {
				@shareWith = split(/,/,$recipientEmailAddresses);
				use Lingua::EN::Nums2Words;
				$howMany = int(@shareWith);
				$wordedMany = lc(num2word($howMany));
				$pluralShare = '';

				##-- logged in, ask to use email address associated with account, then come back to send message
				if ($ISIN ne "") {

					##-- send VPM
					&sendVirtualPrivateMessage($inUID,"VPSNETShare","{f:$First},{l:$Last},{e:$Email},{s:$recipientEmailAddresses}");

					if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
					##-- stuff Good!, need it for response processing AJAX
					if ($howMany==1) { print "Good!Thanks for sharing with <strong>$recipientEmailAddresses</strong>, we appreciate it!"; }
					elsif ($howMany>=2) { print "Good!Thanks for sharing with ".$wordedMany." recipients, we truly appreciate it!"; }
					exit;

				}
				##-- associative UID = OpenCanvasDesign ID (Cart) [IF EXISTS]
				elsif ($OpenCanvasDesign  && ($OpenCanvasDesign ne "" && $OpenCanvasDesign ne " ")) { 
					##-- if exists, we can checked history against it
					$inUID = $OpenCanvasDesign;

					##-- process contact form, then send message if needed
					&processContactForm('Share');
				}
			}
			else {
				if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
				print $whyNewTry;
				exit;
			}
		}
		else {
			if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
			$whyNewTry = 'Recipient email address(es) are missing or incomplete, try again.';
			print $whyNewTry;
			exit;
		}
	}
	elsif (($FORM{'service'} && (int($FORM{'service'})==1)) || ($FORM{'question'} && (int($FORM{'question'})==1))) {
		$q = $FORM{'VirtualPrivateComments'};
		if ((length($q) >= 10) || $template =~ "11111" || $template =~ "22222") { 
			$newCom = &HTMLencodeMyInput($q);

			##-- default subject saving format
			$SUBJECT = ",{chosenSubjects:$ss},{selectedSubject:$OCSO}"; 
			$EntryType = "ContactUs";

			if (($FORM{'question'} && (int($FORM{'question'})==1))) {
				$EntryType = "GeneralQuestion";
				if (($FORM{'question'} && (int($FORM{'question'})==1))) {
					if ((($template && ($template =~ m/ocv/i) && length($template) > 5))) {
						$EntryType = "CanvasQuestion";

						##-- 11111 = saveCanvas & 22222 = submitCanvas
						if ($template =~ "11111" || $template =~ "22222") {
							if ($template =~ "11111") {
								$EntryType = "SaveCanvas";
							}
							else {
								$EntryType = "SubmitCanvas";
							}
						}

					}
				}
			}
			
			##-- [logged in]
			if ($ISIN ne "") {

				$MYSTACK = "";
				if ($template =~ "11111" || $template =~ "22222") { 
					##-- still use the cart ID/canvas ID
					$inUID = $OpenCanvasDesign;
					##-- if saving or submitting canvas, take snapshot of cart/canvas for save: MYSTACK
					$MYSTACK = &makeCartStack($inUID); 
				}

				##-- define proper entry type based on selected subject, save data structure 
				##--clear subjects, if we find true subject
				if ($OCSO eq "Technical Support") { $SUBJECT = ""; $EntryType = "TechnicalSupport"; }
				elsif ($OCSO eq "Customer Service") { $SUBJECT = ""; $EntryType = "CustomerService"; }

				&sendVirtualPrivateMessage($inUID,"$EntryType","{f:$First},{l:$Last},{e:$Email},{m:$newCom}".$SUBJECT."".$MYSTACK."");
				
				##-- create cart tracking cookie [only 22222 submitCart]
				if ($template =~ "22222") { $headerPrinted = &cartMyCanvas($inUID); }
				
				if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }

				if ($template =~ "11111" || $template =~ "22222") {
					if ($template =~ "11111") { print "Account Used by OpenCanvas to Save"; }
					else { print "Account Used by OpenCanvas to Submit"; }
				}
				else {
					print "Account Used";
				}
			}

			##-- associative UID = OpenCanvasDesign ID (Cart) [IF EXISTS]
			elsif ($OpenCanvasDesign  && ($OpenCanvasDesign ne "" && $OpenCanvasDesign ne " ")) { 
				##-- if exists, we can checked history against it
				$inUID = $OpenCanvasDesign;

				##-- if saving or submitting canvas, take snapshot of cart/canvas for save: MYSTACK
				$MYSTACK = "";
				if ($template =~ "11111" || $template =~ "22222") { $MYSTACK = &makeCartStack($inUID); }

				##-- process contact form, then send message if needed
				&processContactForm('Message');
			}

		}
		##-- AJAX keys: message+invalid|short
		else { 
			if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
			print "Your message is too short, we require a minimum of 10 characters length."; 
		}
	}
	##-- NO GOOD INPUT: share | question | service | etc...
	else { 
		if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
		print "BAD!"; 
	}

	exit;
}






sub makeCartStack {
	my $uid = $_[0];

	use DBI;
	my $dbh = DBI->connect("DBI:mysql:vpsnetcom","vpsnetcom","YOUR-MySQL-PASSWORD") or die "No data access: <b>VPS-NET</b>\n"; 
	$dbh->{RaiseError} = 1; 

	##-- get cartid for item we just inserted
	my $sth = $dbh->prepare("SELECT * from customerScarts WHERE UID='$uid' ORDER BY CartID DESC LIMIT 1");
	$sth->execute or die "Error 5231\n";
	my $row = $sth->fetchrow_arrayref;
	my $cartID = $row->[0];
	my $cartCreated = $row->[5];
	my $cartUpdated = $row->[6];
	my $cartHistoric = $row->[8];
	my $cartCanvas = $row->[9];
	my $cartFavorites = $row->[10];
	my $cartTrash = $row->[11];
	my $cartOCv = $row->[12];
	$sth->finish;
	
	$dbh->disconnect; 

	$myStack = ",{Cart:$cartID},{Created:$cartCreated},{Updated:$cartUpdated},{History:$cartHistoric},{Canvas:$cartCanvas},{Favorites:$cartFavorites},{Trash:$cartTrash},{OCv:$cartOCv}";
	return $myStack;
}

sub processContactForm {
	my ($tipo) = @_;
	my $comType = $tipo;
				## attain user information
				$userHistoryDigFailed = 1;
				($userHistoryDigFailed, $itemsFound) = &runThisUser;

				$weWillNeed = "We will need your contact information to submit this correspondence.";
				if ($template =~ "11111" || $template =~ "22222") { 
					if ($template =~ "11111") { 
						$weWillNeed = "We will need your contact information to save your canvas.";
					}
					else { 
						$weWillNeed = "We will need your contact information to submit your canvas.";
					}
				}


				##-- fine if we found user, but only change if we have 3 items found [first,last and email] all of which we were seeking to begin with
				##-- OR 
				##-- user opted to change contact info, showing the form now: 2 [or contact form being processed: 3] 
				if (($userHistoryDigFailed == 0 && $itemsFound == 3) || (int($ec) == 2 || int($ec) == 3)) {
					##-- consent given to use email on file
					if (int($ec) == 1) {
						if ($comType eq "Message") {

							$MYSTACK = "";
							if ($template =~ "11111" || $template =~ "22222") { 
								##-- still use the cart ID/canvas ID
								$inUID = $OpenCanvasDesign;
								##-- if saving or submitting canvas, take snapshot of cart/canvas for save: MYSTACK
								$MYSTACK = &makeCartStack($inUID); 
							}
						
							##-- send VPM
							&sendVirtualPrivateMessage($inUID,"$EntryType","{f:$previouslyUsedFirst},{l:$previouslyUsedLast},{e:$previouslyUsedEmail},{m:$newCom}".$MYSTACK."");

							##-- create cart tracking cookie [only 22222 submitCart]
							if ($template =~ "22222") { $headerPrinted = &cartMyCanvas($inUID); }

							if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
							if ($template =~ "11111" || $template =~ "22222") { 
								if ($template =~ "11111") { print "Contact Info Used by OpenCanvas to Save"; }
								else { print "Contact Info Used by OpenCanvas to Submit"; }
							}
							else { print "Contact Info Used"; }
						}
						elsif ($comType eq "Share") {
							##-- send VPM
							&sendVirtualPrivateMessage($inUID,"VPSNETShare","{f:$previouslyUsedFirst},{l:$previouslyUsedLast},{e:$previouslyUsedEmail},{s:$recipientEmailAddresses}");
							if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
							##-- stuff Good!, need it for response processing AJAX
							if ($howMany==1) { print "Good!Thanks for sharing with <strong>$recipientEmailAddresses</strong>, we appreciate it!"; }
							elsif ($howMany>=2) { print "Good!Thanks for sharing with ".$wordedMany." recipients, we truly appreciate it!"; }						
						}
						exit;
					}
					##-- user opted to change contact info, showing the form now: 2 [or contact form being processed: 3] 
					elsif (int($ec) == 2 || int($ec) == 3) {

						#-- gotten to ec=3, meaning: Contact information form is visible and being submitted
						if (!(!$FORM{'VirtualPrivateUser'}) && int($ec) == 3){
							$vpue = $FORM{'VirtualPrivateUser'};
							$em = $vpue;
							$LastFailed = 1;
							if (length($vpue) >= 5) {
								$EmailFailed = &checkNewEmail;
								##--email good
								if ($EmailFailed == 0) {
									$n = $FORM{'VPSNETFirst'};
									$nx = $FORM{'VPSNETLast'};
									$FirstFailed = 1;
									$LastFailed = 1;
									##-- first/last name asynchronous checking
									$FirstFailed = &checkName($n,'First','first name');
									if ($FirstFailed == 0) { $LastFailed = &checkName($nx,'Last','last name'); }
									##-- only after asking for first/last/email
									if ($FirstFailed == 0 && $LastFailed == 0) {
										if ($comType eq "Message") {

											$MYSTACK = "";
											if ($template =~ "11111" || $template =~ "22222") { 
												##-- still use the cart ID/canvas ID
												$inUID = $OpenCanvasDesign;
												##-- if saving or submitting canvas, take snapshot of cart/canvas for save: MYSTACK
												$MYSTACK = &makeCartStack($inUID); 
											}

											##-- create cart tracking cookie [only 22222 submitCart]
											if ($template =~ "22222") { $headerPrinted = &cartMyCanvas($inUID); }
							
											&sendVirtualPrivateMessage($inUID,"$EntryType","{f:$n},{l:$nx},{e:$em},{m:$newCom}".$MYSTACK."");
											if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
											if ($template =~ "11111" || $template =~ "22222") { 
												if ($template =~ "11111") { print "Contact Info Used by OpenCanvas to Save"; }
												else { print "Contact Info Used by OpenCanvas to Submit"; }
											}
											else { print "Contact Info Used"; }
										}
										elsif ($comType eq "Share") {
											##-- send VPM
											&sendVirtualPrivateMessage($inUID,"VPSNETShare","{f:$n},{l:$nx},{e:$em},{s:$recipientEmailAddresses}");
											##-- stuff Good!, need it for response processing AJAX
											if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
											if ($howMany==1) { print "Good!Thanks for sharing with <strong>$recipientEmailAddresses</strong>, we appreciate it!"; }
											elsif ($howMany>=2) { print "Good!Thanks for sharing with ".$wordedMany." recipients, we truly appreciate it!"; }						
										}
										exit;
									}
									else {
										$badField = 'VPSNETFirst';
										if ($FirstFailed == 0) { $badField = 'VPSNETLast'; }
										$feedbackScript .= "contactInformationForm('$badField','$netAgent');";
										if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
										print "TryAgain!".$whyNewTry."";
										exit;
									}
								}
								##--email fail
								else {
									if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
									print $whyNewTry;
									exit;
								}
							}
							else {
								if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
								if (length($vpue) >= 5) { print 'Your email address is invalid, please try again.'; }
								else { print 'Your email address is missing or incomplete.'; }
								exit;
							}
						}
						else {
							if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
							print $weWillNeed;
							exit;
						}
					}
					else {
						if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
						
						
						##-- 11111 = saveCanvas & 22222 = submitCanvas
						if ($template =~ "11111" || $template =~ "22222") {
							if ($template =~ "11111") {
								print "Canvas will be saved";
							}
							else {
								print "Canvas will be submitted";
							}
						}
						else {
							print "Message will be sent";
						}

						print " using <b>$previouslyUsedEmail</b>";
						exit;
					}
				}
				##-- request contact info
				else {
					if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
					print $weWillNeed;
					exit;
				}
}














###-----CAN ONLY COME THROUGH HERE IF:
###-----A: Template Cookie in Place
###-----B: Canvas Cookie in Place 
###-----C: Both are legit
###-----OR INTERNAL CALL [CONTROLLED ENVIRONMENT]

##-- template functions
if ((($template && ($template =~ m/ocv/i) && length($template) > 5)) || $ISINTERNAL) {

	if ($OpenCanvasDesign  && ($OpenCanvasDesign ne "" && $OpenCanvasDesign ne " ")) {

		## --> already has OCv cookie
		$hasOCV = 0;
		$inOCV = 1;
		$inOCV = $OpenCanvasVersion;
		if (int($inOCV) > 0 && int($inOCV) <= 3) { $hasOCV = $inOCV; }


		##-- acquire OCv from form input: target = OCX|OC2|OC3 and TEMPLATE-ID
		$CualOC = 0;
		if ($template) { $CualOC = substr $template, 3, 1; }

		##-- look for change cookie vs form OCv
		$newOCv = 0;
		if (int($CualOC) != int($inOCV)) {
			$newOCv = int($CualOC);
		}
		else {
			$CualOC = int($inOCV);
		}

		##-- set canvas version cookie if diff from old cookie
		print "Cache-Control: must-revalidate\n";
		if (int($newOCv) > 0 && $inUID ne "" && $inUID ne " ") {
			my $ahora = today();
			my $CCD = $ahora + 365;
			$Cookie_Exp_Date = substr($days[$CCD->day_of_week],0,3) . ", " . $CCD->day . "-" . substr($months[($CCD->month-1)],0,3) . "-" . $CCD->year . " 23:59:59 GMT";
			&SetCookies('OpenCanvasVersion',$newOCv);

			$CanvasUpdateQuery = "UPDATE LOW_PRIORITY customerScarts SET LastUpdated='$datetime', OCv='$newOCv' WHERE UID='$inUID'";
			
			$CualOC = $newOCv;
		}
		print "\n";

		$inUID = $OpenCanvasDesign;
		## ----------------->>> 	
		## ----------------->>> FIRST read saved cart
		## ----------------->>> 

		use DBI;
		my $dbh = DBI->connect("DBI:mysql:vpsnetcom","vpsnetcom","YOUR-MySQL-PASSWORD") or die "No data access: <b>VPS-NET</b>\n"; 
		$dbh->{RaiseError} = 1; 

		my $sth = $dbh->prepare("SELECT * FROM customerScarts WHERE UID = '$inUID'");
		$sth->execute or die "Error 5231\n";
		my $row = $sth->fetchrow_arrayref;
		my $cartID = $row->[0];
		my $cartContents = $row->[2];
		my $cartEA = $row->[3];
		my $cartCID = $row->[4];
		my $cartDate = $row->[5];
		my $cartHistory = $row->[8];
		$sth->finish;
		$dbh->disconnect;


		##--START DECRYPT

		$llave = int($cartID);
		$ENUID = &decrypt ($inUID, $llave);

		###REFORM UID FROM COOKIE PER SE
		##-- add dashes to reformat UUID 8,4,4,4,12
		$remadeUID = substr($ENUID,0,8) . '-' . substr($ENUID,8,4) . '-' . substr($ENUID,12,4) . '-' . substr($ENUID,16,4) . '-' . substr($ENUID,20,32);

		use Data::UUID;
  		$ug2 = new Data::UUID;
		$idHash = $ug2->from_string($remadeUID);
		$idHash =~ s/[^a-zA-Z0-9-]//g;

		##--deSalt
		$idHash =~ s/N/0/gi; $idHash =~ s/E/1/gi; $idHash =~ s/T/2/gi; $idHash =~ s/W/3/gi; $idHash =~ s/O/4/gi; $idHash =~ s/R/5/gi; $idHash =~ s/K/6/gi; $idHash =~ s/S/7/gi; $idHash =~ s/P/8/gi; $idHash =~ s/V/9/gi;

		##--unStack
		($UIDIP, $UIDCARTID) = split(/-/,$idHash);
		
		##--saltyCID
		$saltyCID = $UIDCARTID;
		$saltyCID =~ s/0/W/gi; $saltyCID =~ s/1/E/gi; $saltyCID =~ s/2/B/gi; $saltyCID =~ s/3/S/gi; $saltyCID =~ s/4/I/gi; $saltyCID =~ s/5/T/gi; $saltyCID =~ s/6/D/gi; $saltyCID =~ s/7/G/gi; $saltyCID =~ s/8/N/gi; $saltyCID =~ s/9/R/gi;
		@idRev = split(//,$saltyCID);
		$saltyCID = join('',reverse(@idRev));
		$idHash =~ s/$UIDCARTID/$saltyCID/g;

		##--recreate IP
		use Net::IPAddress::Minimal ('invert_ip');
		$trueIP = invert_ip( $UIDIP );

		##--END DECRYPT
		




		##-- failed cookie test
		if (int($UIDCARTID) != int($cartID)) {
			##--> Hack attempt / or bad input
			if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
			print "<script language=\"Javascript\" type=\"text/javascript\">alert('Error 2252: Saved OpenCanvas data does not match data passed by your web browser cookie, therefore we will be reloading your OpenCanvas. It is advisable you take note of this error and report it to the site administrator. Thanks.');if (!(!parent.activeTemplates)) { parent.\$.fancybox.close(); } else { document.location.href = '/'; }</script>";
			exit;
		}


		if ($ISINTERNAL || $Todo_Form[0] =~ "service" || $Todo_Form[0] =~ "editc" || $Todo_Form[0] =~ "addc" || $Todo_Form[0] =~ "question" || $Todo_Form[0] =~ "share") {

			##-- acquire template params
			require($HTTPRoot."opencanvas-interactive-website-design/templateSucka.nsp");

			$elTitulo = 'Design Notes';
			$feedback = 'Jot down notes, ideas or comments about this design:';
			$cancelAction = 'Cancel';
			$cancelAct = 'Canceling';
			$closeAct = $MYCLOSER;
			$submitAct = 'Save Comments';
			$submitActive = 'Saving';
			

			##--prepare internal call params
			if ($ISINTERNAL && $ISSERVICE) { $myact = "service"; $myactstate = '1'; }
			
			##-- edit comments (templates)
			if ($myact eq "editc") {
				$feedback = 'Edit your template specific notes:';
				$cancelAction = 'Delete Comments';
				$cancelAct = 'Deleting';
				$submitAct = 'Save Changes';
				##-- $processingScript - dynamic form submission script
				$processingScript = "else if (action == 'Deleting') { document.VirtualPrivateComment.x.value = '1'; document.VirtualPrivateComment.submit(); }";
			}
			##-- general inquiry
			elsif ($myact eq "question" || $myact eq "service") {

				$feedbackScript = "javascript:document.VirtualPrivateComment.VirtualPrivateSelectorOutput.focus();";
				$elTitulo = 'Questions &#38; Feedback';
				$feedback = 'Your questions and feedback are always welcome:';
				
				###-- already logged in (checked by cookiesnif.nsp)
				###-- NOT SURE WHY WRITTEN LIKE THIS, WORKS THE SAME EITHER WAY, LEAVE FOR NOW
				###-- SINCE, WE ALWAYS CHECK FOR LOGIN STATE AT EVERY CALL, NO USE FOR JS POINTERS OTHER THAN JS REASONS (pretteh)
				if ($ISIN ne "") {
					$submitAct = 'Send Your Message';
					$submitActive = 'Sending';
					$processingScript = "else if (action == 'Sending') { stcf(); return false; } ";
				}
				##-- not logged, ajax junction before true send, ask for first name and email address
				else {
					$submitAct = 'Submit Your Correspondence';
					$submitActive = 'Submitting';
					$processingScript = "else if (action == 'Submitting') { stcf(); return false; } ";

				}

				##-- 11111 = saveCanvas & 22222 = submitCanvas
				if ($template =~ "11111" || $template =~ "22222") {
					if ($template =~ "11111") {
						$elTitulo = "Save Your Canvas";
						$feedback = 'Add notes to your canvas if you&rsquo;d like:';
						$submitAct = 'Save Your Canvas';
					}
					else {
						$elTitulo = "Submit Your Canvas";
						$feedback = 'If you&rsquo;d like, add message to Virtual<font style=color:#266899>Private</font>:';
						$submitAct = 'Submit Your Canvas';
					}
				}

			}
			##-- share/socialize
			elsif ($myact eq "share") {
				$feedbackScript = "javascript:document.VirtualPrivateComment.VirtualPrivateSelectorOutput.focus();";
				$elTitulo = 'Sharing is Caring';
				$feedback = 'Recipient email address (use comma for multiple):';
				$submitAct = 'Share It!';
				$submitActive = 'Sharing';
				$processingScript = "else if (action == 'Sharing') { stcf(); return false; } ";
			}


			##-- anything but not for edit comments (templates)
			if ($myact eq "editc" || $myact eq "addc") {
				$userStatus = '';
			}
			else {
				###-- already logged in (checked by cookiesnif.nsp)
				###-- NOT SURE WHY WRITTEN LIKE THIS, WORKS THE SAME EITHER WAY, LEAVE FOR NOW
				###-- SINCE, WE ALWAYS CHECK FOR LOGIN STATE AT EVERY CALL, NO USE FOR JS POINTERS OTHER THAN JS REASONS (pretteh)
				if ($ISIN ne "") {
					$Email =~ s/\[at\]/@/gi;
					$userStatus = $userStatusBar;
					$myUserStatus = "<span id=\"CommunicationsLogin\" class=\"UserStatus\" title=\"<b>$First $Last</b>,<br><br>The contact information associated with your VPS-NET account will be used to submit this message. To reiterate, <span class=The-Experts-Virtual-Private-VPS-NET><b>$Email</b> will be used to send this correspondence</span>, that is unless you opt to:</span><br><br><em>Alternately:</em> <span class=The-Experts-Virtual-Private-VPS-NET>Click now to sign out</span>, then simply come back here and use the contact information you prefer.\" onclick=\"javascript:if(!(!parent) && (!(!parent.runFancyFancy))) { parent.runFancyFancy('/logout.htm','Virtual Private',580,260); } else { location.href='/logout.htm'; } \">$Email<a class=\"userarrow\"></a></span><span title=\"Edit account settings\" class=\"UserStatus\" id=\"UserSettings\"><a class=\"userconfig\"></a></span>";
					$userStatus =~ s/%%USERSTATUS%%/$myUserStatus/gi;
				}
				##-- not logged, ajax junction before true send, ask for first name and email address
				else {

					##-- show the contact information form, we will might be needing it
					$SHOWCONTACT = 1;

					## attain user information
					$userHistoryDigFailed = 1;
					($userHistoryDigFailed, $itemsFound) = &runThisUser;

					##-- fine if we found user, but only change if we have 3 items found, namely: first,last and email, all of which we were seeking to begin with
					if ($userHistoryDigFailed == 0 && $itemsFound == 3) {
						$greetingStack = "<b>$previouslyUsedFirst $previouslyUsedLast,</b><br><br>"; 
					}
					elsif ($userHistoryDigFailed == 0 && $itemsFound >= 1) {
						$CIStack = "";
						if ($previouslyUsedFirst) { $CIStack .= " First Name: <b>$previouslyUsedFirst</b><br>"; }
						if ($previouslyUsedLast) { $CIStack .= " Last Name: <b>$previouslyUsedLast</b><br>"; }
						if ($previouslyUsedEmail) { $CIStack .= " Email Address: <b>$previouslyUsedEmail</b><br>"; }
						if ($CIStack ne "") {
							$showStack = "<br><br>We have the following contact information for you:<br><br>$CIStack"; 
						}
						##-- no good stack
						else {
							$showStack = "<br><br>Even though we may have some of your contact information already, we might need more information to submit this message.";
						}
						$showStack .= "<span class=Alternately><br><br><em>Alternately:</em> You can <span class=The-Experts-Virtual-Private-VPS-NET>click now</span> to load the contact information form, which will allow you to change your contact settings.</span>";
					}

					$userStatus = $userStatusBar;
					$myUserStatus = "<span id=\"CommunicationsLogin\" class=\"UserStatus\" title=\"Signing in is not necessary, however we do require your first name, last name and email address to submit correspondence.<br><br><em>Note:</em> If you have a VPS-NET account, you can easily by-pass entering your contact information again simply by signing in.\" onclick=\"javascript:if(!(!parent) && (!(!parent.runFancyFancy))) { parent.runFancyFancy('/login.htm','Virtual Private',580,260); } else { location.href='/login.htm'; } \">Sign in<a class=\"userarrow\"></a></span><span title=\"".$greetingStack."Contact information you may have previously used in submitting feedback, questions or comments to, or in sending correspondence via VPS-NET, will be used to send this message.$showStack\" class=\"UserStatus ActiveUser\" id=\"UserSettings\" onClick=\"javascript:ec=2;if (hasClicked == 0) { return runClick(document.VirtualPrivateComment.CanvasSubmit,submitActive); }\"><a class=\"userconfig\"></a></span>";
					$userStatus =~ s/%%USERSTATUS%%/$myUserStatus/gi;
				}
			}

			use DBI;
			my $dbh = DBI->connect("DBI:mysql:vpsnetcom","vpsnetcom","YOUR-MySQL-PASSWORD") or die "No data access: <b>VPS-NET</b>\n"; 
			$dbh->{RaiseError} = 1; 

			##--saving
			if ($Todo_Form[3] && ($Todo_Form[3] =~ "VirtualPrivateComments")) {
				$feedback = 'Saving your changes to template notes.';
				$feedbackCSS = "color:#009900;";
				$newCom = "";
				if ($FORM{'VirtualPrivateComments'}) { $newCom = &HTMLencodeMyInput($FORM{'VirtualPrivateComments'}); }
				$Com = $newCom;
				if ($Todo_Form[4] =~ "x---") {
					$feedback = 'Attempting to delete your template notes.';
					my $sth = $dbh->prepare("DELETE FROM CommentsLog WHERE (CartID = '$cartID' AND TemplateID = '$TN' AND UID = '$inUID')");
					$sth->execute or die "Unable to execute query\n";
					$sth->finish;
					$cancelAction = 'Deleted';
					##-- clear visible comments for user
					$Com = '';
					$feedback = 'Your notes for this template have been deleted.';
					$feedbackCSS = "color:#EB0000;";
					$feedbackScript = "javascript:if (!(!parent.activeTemplates)) { parent.activeTemplates[$TN].comments = 0; parent.swapCanvasCommentState($TN); parent.\$.fancybox.close(); }";
				}
				else {
					if ($myact eq "addc") { 
						my $sth = $dbh->prepare("INSERT INTO CommentsLog (LineID, CartID, TemplateID, Comment, CreationDate, UID) VALUES (Null, '$cartID', '$TN', '$Com', '$datetime', '$inUID')");
						$sth->execute or die "Unable to execute query\n";
						$sth->finish;
					}
					else {
						##- when we are saving, js disables 'Save Comments' button and renames it to Saving, so we wanna show this same text on button once the save action has been completed.
						my $sth = $dbh->prepare("UPDATE CommentsLog SET Comment='$Com' WHERE (CartID = '$cartID' AND TemplateID = '$TN' AND UID = '$inUID')");
						$sth->execute or die "Unable to execute query\n";
						$sth->finish;
					}
					$submitAct = 'Saved';
					$feedback = 'Your notes were saved successfully!';
				}

				##only if not previously set
				if (!$feedbackScript) { 
					$feedbackScript = "javascript:if (!(!parent.activeTemplates)) { parent.activeTemplates[$TN].comments = 1; parent.swapCanvasCommentState($TN); parent.\$.fancybox.close(); }"; 
				}
			}
			##--editing
			else {
				if ($TN) {
					##--$TN coming from templateSucka
					my $sth = $dbh->prepare("SELECT Comment, CreationDate FROM CommentsLog WHERE (CartID = '$cartID' AND TemplateID = '$TN' AND UID = '$inUID')");
					$sth->execute or die "Error 5231\n";
					my $row = $sth->fetchrow_arrayref;
					$Com = $row->[0];
					$ComAdded = $row->[1];
					$sth->finish;
				}
			}

			$dbh->disconnect;

			$cualScript = 'parent.previewTemplate';
			if ($ppage && ($ppage =~ 'images.templatemonster.com')) {
				$cualScript = 'parent.runFlash';
			}
		}
	}



	##-- template request
	if (($FORM{'t'} =~ "OCv" || $FORM{'t'} =~ "ocv") && length($FORM{'t'}) > 5) {

		## --> already has OCv cookie
		$hasOCV = 0;
		$inOCV = 1;
		$inOCV = $OpenCanvasVersion;
		if (int($inOCV) > 0 && int($inOCV) <= 3) { $hasOCV = $inOCV; }

		##-- acquire OCv from form input: target = OCX|OC2|OC3 and TEMPLATE-ID
		$CualOC = substr $FORM{'t'}, 3, 1;

		$myFullTemplateNumber = "OCv".$CualOC."".$TN;

		$inUID = $OpenCanvasDesign;

		## if we dont have UID yet, which means we havent created our OpenCanvasDesign Cookie yet, no items added to canvas
		if ($inUID ne "" && $inUID ne " ") {
			if (int($inUID) > 120975) {
				my $sth = $dbh->prepare("SELECT CartID FROM customerScarts where UID='$inUID'");
				$sth->execute;
				$row2 = $sth->fetchrow_arrayref;
				$CartID = $row2->[0];
			}
		}
		$myFullCanvasNumber = $CualOC."".$CartID;
		$myFullCanvasID = "OCv".$myFullCanvasNumber;
	}


	#else {
	#	##--> no cookie found, reload their document
	#	if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
	#	print "<script language=\"Javascript\" type=\"text/javascript\">alert('Error 2251: It is advisable you take note of this error and report it to the site administrator. Due to this error, we will be reloading the page you are currently on.');if (!(!parent.activeTemplates)) { parent.\$.fancybox.close(); parent.location.href=parent.location; } else { document.location.href = '/'; }</script>";
	#	exit;
	#}
}


$templateScript = "$cualScript('$TN');";

$whichNumberVanity = "1(213)293-GURU";
$whichNumberDID = "1(213)293-4878";
$whichDocTitle = "OpenCanvas Websites";
$whoReach = "OpenCanvas Website Design, a Virtual Private Web Development service,";
$guruScript = '';
$guruText = "";
##-- if no template number, is virtual private logo, script 'em home
if ($trueTN eq "") {
	##-- overwrite template number 
	$templateScript = "parent.location.href = 'http://www.vps-net.com/';";
	$whichNumberVanity = "1(213)293-GURU";
	$whichNumberDID = "1(213)293-4878";
	$whichDocTitle = 'Virtual Private';
	$whoReach = "Technology Gurus at Virtual Private Servers and Networks";
	$guruScript = 'onClick="if(!(!parent.runWikiBoard)) { parent.runWikiBoard(this); }else { document.location.href = this.rel; }"  rel="/wikipedia.htm?st=Guru_(disambiguation)#See_also"';
	$guruText = "... What's a guru? Well a guru is an expert, or in other words, a person with extensive knowledge or ability in a particular domain, click to read more...";
}

$losComments = $Com;
if (!$feedbackScript) {
	$feedbackScript = "javascript:document.VirtualPrivateComment.VirtualPrivateComments.select();"; 
}




$TAheight = "136px";
if($myact && ($myact eq "question" || $myact eq "service" || $myact eq "share")) {
	$losComments = '';
	$TAheight = "46px";

	if ($template =~ "11111" || $template =~ "22222") {
		$TAheight = "136px";
		if ($template =~ "11111" || $template =~ "22222" && (!$feedbackScript || $feedbackScript =~ 'VirtualPrivateSelectorOutput')) {
			$feedbackScript = "javascript:document.VirtualPrivateComment.VirtualPrivateComments.select();"; 
		}
	}
}

$vpsneturl = 'http://www.vps-net.com/';

















$ISUNROUTED = 0;
$actionMessage = '';
$processCompleted = 0;
##- IF $myact NOT SET BY THIS STAGE is UNLOGGED/UNROUTED USER (UNROUTED = NO OPENCANVAS, FEET NOT WET)
##- HARD SET $myact
if ($myact eq "" || $myact eq "ContactVirtualPrivate") {
	$ISUNROUTED = 1;
	$myact = "ContactVirtualPrivate";
	$myactstate = 1; 
	$TAheight = "56px";
	$feedbackScript = 'javascript:var d1=document.getElementById(\'VisualSwapOne\').innerHTML;var d2=document.getElementById(\'VisualSwapTwo\').innerHTML;document.getElementById(\'VisualSwapOne\').innerHTML=d2;document.getElementById(\'VisualSwapTwo\').innerHTML=d1;d1=\'\';d2=\'\';';

	$EntryType = "ContactUs";
	if (($FORM{'question'} && (int($FORM{'question'})==1))) {
		$EntryType = "GeneralQuestion";
			if (($FORM{'question'} && (int($FORM{'question'})==1))) {
				if ((($template && ($template =~ m/ocv/i) && length($template) > 5))) {
				$EntryType = "CanvasQuestion";
			}
		}
	}

	if (!(!$FORM{'VirtualPrivateUser'})){
	
		$vpue = $FORM{'VirtualPrivateUser'};
		$em = $vpue;
		$q = $FORM{'VirtualPrivateComments'};
		$EmailFailed = 1;
		$requestOPTIN = 1;

		if (length($vpue) >= 5 && !(lc($vpue) =~ "e-mail address")) {
			$EmailFailed = &checkNewEmail;
			##--email good
			if ($EmailFailed == 0) {
				if (length($q) >= 10 && !(lc($q) =~ "how may our expert technical or friendly support staff be of assistance?")) { 
					$newCom = &HTMLencodeMyInput($q);

					##-- now that we have email and message, save to communication log
					##-- only save if first/last/phone not being transmitted
					if (!$FORM{'VPSNETFirst'} && !$FORM{'VPSNETLast'} && !$FORM{'VPSNETPhone'}) {
						&saveVirtualPrivateMessage("$EntryType","{e:$vpue},{m:$newCom}");
					}

					##-- 
					##-- ONLY send before we ask for first/last/phone, not while asking, meaning only save/send once
					##-- 

					##-- 
					##-- NOW that we've saved the message, ask for first/last/phone, if given we append otherwise we leave alone
					##-- 
						$processCompleted = 1;
						$actionMessage = "We will need your contact information to submit this correspondence.";

						$submitAct = 'Submit Contact Info';
						$submitActive = 'Submitting';

						$n = $FORM{'VPSNETFirst'};
						$nx = $FORM{'VPSNETLast'};
						$FirstFailed = 1;
						$LastFailed = 1;
						##-- first/last name asynchronous checking
						$FirstFailed = &checkName($n,'First','first name');
						if ($FirstFailed == 0) { $LastFailed = &checkName($nx,'Last','last name'); }

						##-- only after asking for first/last/phone
						if ($FirstFailed == 0 && $LastFailed == 0) {
							

							$saveDID = "";
							$saveLeadNumber = "";
							##-- only if user tries giving us phone number, will we check it, otherwise we skip it
							if (length($FORM{'VPSNETDID'}) >= 1) {
								$DID = $FORM{'VPSNETDID'};
								$PhoneFailed = &checkPhoneNumber($DID);
							}

							##-- phone number can only fail if submitted 1 or more characters on its input field
							if (!$PhoneFailed || ($PhoneFailed == 0)) {
								##-- but not before slating just the digits for save
								if ($DID && (length($DID) == 10)) { 
									$saveDID = ",{lead:".$DID."}";
									$saveLeadNumber = $DID;
									$FORM{'DID'} = $DID;
								}

								##-- associative UID = OpenCanvasDesign ID (Cart) [IF EXISTS]
								if ($OpenCanvasDesign  && ($OpenCanvasDesign ne "" && $OpenCanvasDesign ne " ")) { 
									##-- if exists, we can checked history against it
									$inUID = $OpenCanvasDesign; 
									#-- check to see if user has already opted-in for this type of mailer
									$requestOPTIN = &checkOptIns("EntryType='AskAnExpert-OptIn'","},{e:$vpue},{optin:Yes}");
								}
								##-- no OpenCanvas cookie [UID] present, lets hook one up
								##-- $inUID is generated
								##-- if successful, cookie placed, header printed and returned as such
								else { $headerPrinted = &bakeMyCanvasCartCookie; }

								##--now that we have first and last name, maybe even phone number, update the log
								&updateVirtualPrivateMessage($inUID,"$EntryType","{e:$vpue},{m:","{f:$n},{l:$nx},{e:$vpue}".$saveDID.",{m:$newCom}","$saveLeadNumber");

								$processCompleted = 1; 
								$actionMessage = "Message successfully sent, as well as your contact information saved."; 
								###-- OPT IN TURNED OFF FOR THIS TYPE OF COMMUNICATION [hence line above]
								##-- ASK USER to opt-in: Message sent.
								#-if ($requestOPTIN == 1) { $processCompleted = 2; $actionMessage = "Message successfully sent, thanks for your correspondence."; }
								##-- USER ALREADY OPTED-IN for this type of communication
								##-- ONLY tell of message success: Message Sent
								#-else { $processCompleted = 1; $actionMessage = "Message successfully sent, we thank you for your correspondence."; }

								##-- revert back to normalcy
								$submitAct = 'Submit Message';
								$submitActive = 'Submitting';
							}
							##-- phone number was submitted, and when checked, returned bad
							elsif ($PhoneFailed == 1) {
								$processCompleted = 0;
								$actionMessage = $whyNewTry;
								$FORM{'VPSNETDID'} = $DID;
								$feedbackScript .= "contactInformationForm('VPSNETDID','$netAgent');";
							}
						}
						elsif ($FORM{'VPSNETFirst'} && $FORM{'VPSNETLast'}) {
							$processCompleted = 0;
							$actionMessage = $whyNewTry;
							$badField = 'VPSNETFirst';
							if ($FirstFailed == 0) { $badField = 'VPSNETLast'; }
							$feedbackScript .= "contactInformationForm('$badField','$netAgent');";
						}
				}
				else {
					if (length($q) >= 10) { $actionMessage = "Your message was rejected based on its perceived content, please rephrase your question."; } 
					else { $actionMessage = "Your message is too short, it must be at least 10 characters long."; } 
				}
			}
			##--email fail
			else { 
				$actionMessage = $whyNewTry; 
			}
		}
		else {
			if (length($vpue) >= 5) { $actionMessage = 'Your email address is invalid, please try again.'; }
			else { $actionMessage = 'Your email address is missing or incomplete.'; }
		}
	}

	if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
	if ($actionMessage ne '') {
		$tailor = '-error';
		$actionMessage =~ s/'/\\'/gi;
		$actionMessage =~ s/"//gi;
		$makeSelected = 'document.VirtualPrivateComment.VirtualPrivateUser.select();';
		###-- comment/question/message feedback
		if ($actionMessage =~ 'message') { 
			$makeSelected = 'document.VirtualPrivateComment.VirtualPrivateComments.select();'; 
		}
		###-- contact information gathering
		elsif (($actionMessage =~ 'need' && $actionMessage =~ 'contact' && $actionMessage =~ 'information' && $actionMessage =~ 'correspondence') || $actionMessage =~ 'first' || $actionMessage =~ 'last' || $actionMessage =~ 'phone') { 

			##--was panelView, panelView now only for configuration/context
			$NEEDCONTACT = 1;

			## find MSIE buggers 5/6/7/8 wheras 9+ are ok [fade]
			$netAgent =~ s/'//gi;

			## first go round, first show of this changed form
			if ($feedbackScript !~ 'contactInformationForm') { $feedbackScript .= "contactInformationForm('VPSNETFirst','$netAgent');"; }

			## this form selection parsed by in-line script
			$makeSelected = ' ';
		}
		
		$losComments = $q;
		$actionTimer = "";
		##-- truly a process has been completed, no need to return the comments to the textarea
		if ($processCompleted >= 1 && !$FirstFailed && !$LastFailed && !$PhoneFailed) { 
			$losComments = '';
			$tailor = '-contact-added';
			$makeSelected = ' ';
			##-- only if truly last action do we time it at 2700 milliseconds, 
			##-- for at 5000 into that timer, we have our interactive form give another message telling user window will close, if applies
			if (length($FORM{'VPSNETFirst'}) >= 1 && !$FirstFailed && !$LastFailed && !$PhoneFailed) {
				$actionTimer = "actiontimer=2700;";
			}
		}

		##-- can only be from UNROUTED form
		##--skip opt-in for this type [wasn't finished anyway, but yeah, just skip]
		##- if ($processCompleted == 2) { $askOptIn = 'optInMess();'; $makeSelected = $askOptIn; }

		$feedbackScript .= $actionTimer."actionMessage('<div id=\\'comments-form-message\\' class=\\'comments-form-message".$tailor."\\'>$actionMessage</div>');" . $makeSelected . ""; 

	}
	if (!$makeSelected) { $feedbackScript .= 'document.VirtualPrivateComment.VirtualPrivateUser.select();'; }

}










	##-- zopim active notes
	if ($myact eq "question" || $myact eq "service") {
		##-- remove in Dec, 2017, until new zopim API integrated
		#- $zopimActive = '$zopim.livechat.setNotes(\'Currently selected: \' + document.VirtualPrivateComment.VirtualPrivateSelectorOutput.value +  \' ::::::::::::::: All selected: \'+ whosChanged + \'\');';
	}


### HEADER WAS, MIGHT HAVE BEEN AN IE ISSUE, DOUBLE-CHECK LATER:
##<?xml version="1.0"?>
##<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
##<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
### FOR NOW, since <?xml version="1.0"?> is not good, change to:
print qq~
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE = 8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
~; if ($myHead) { print $myHead; } print qq~
<link rel="stylesheet" type="text/css" href="/yui.css">
<link rel="stylesheet" type="text/css" href="/javascript-jquery-extension_fancybox-1.3.1.css">
<link rel="stylesheet" type="text/css" href="/jquery.bubblepopup.v2.3.1.css">
<link rel="stylesheet" type="text/css" href="/interface_design_templater.php?q=1&p=CHCSS">
<style type="text/css">
body { overflow-x:hidden;overflow-y:hidden; background:url(/web_design_imagery/accountModel-background-newAccount.png); background-position:bottom right; background-attachment: fixed; background-repeat: no-repeat; }
#panel { display:none; position:absolute;right:0px;top:0px;height:100%;width:100%;z-index:25; overflow-x:hidden;overflow-y:hidden; background:#FFFFFF url(/web_design_imagery/accountModel-background-newAccount.png); background-position:bottom right; background-attachment: fixed; background-repeat: no-repeat; }
#panelContent { display:none; position:absolute;right:0px;top:0px;height:100%;width:100%;z-index:25; overflow-x:hidden;overflow-y:hidden; background:#FFFFFF url(/web_design_imagery/accountModel-background-newAccount.png); background-position:bottom right; background-attachment: fixed; background-repeat: no-repeat; }
#content { visibility:visible;display:visible; }
.VirtualPrivateCommentWrapper { height:210px; }
.VirtualPrivateCommentFormContainer { height:202px; padding-left:15px; padding-right:15px; padding-top:10px; }
.VirtualPrivateCommentPrompt { font-family:tahoma,arial,verdana; font-size:12px; font-weight:bold; color:#000000; }
.VirtualPrivateCommentInstructions { margin-bottom:10px; font-family:verdana,tahoma,arial; font-size:12px; color:#000000; font-weight:normal; }
textarea.VirtualPrivateCommentTextarea { width:100%; height:$TAheight; font-family:Courier New,monospace,serif; font-size:14px; }
#VirtualPrivateUser, #VPSNETFirst, #VPSNETLast, #VPSNETDID { padding:2px; width:65%; font-family:Courier New,monospace,serif; font-size:14px; }
#VPSNETFirst, #VPSNETLast, #VPSNETDID { width:90%; padding:2px; font-size:14px; }
#VPSNETDID { width:55%; text-align:center; }
label.VirtualPrivateCommentLabel { font-size:14px; $feedbackCSS }
#ContactFieldset { }
#ContactFieldset label.VirtualPrivateCommentLabel { font-size:12px; }
input.VirtualPrivateSelectorOutput { font-family:Courier New,monospace,serif; font-size:14px; }
#VirtualPrivateSelectorOutput { padding:0.50%; margin-bottom:2px; }
#VirtualPrivateSelectorPrintout { 
	margin-bottom:10px;
	padding-left:20px;
	/*border-top:#ABADB3 1px solid; border-left:#E2E3EA 1px solid; border-right:#E2E3EA 1px solid; border-bottom:#E3E9EF 1px solid; */
}

.Call-Virtual-Private-VPS-NET { color:#000; }
.Call-Virtual-Private-VPS-NET:hover { color:#3F8FBD; }
.The-Experts-Virtual-Private-VPS-NET { color:#3F8FBD; }
#VirtualPrivateCommentActions {height:27px;}
#VirtualPrivateActivity { padding-right:10px; }
#VirtualPrivateCommentButtons { }
#TemplateCommentAreas { margin-bottom:10px; }
#infoWrap { padding-left:15px; padding-right:15px; padding-bottom:6px; position:relative; top:0px; left:0px; }

#templateModalImage { position:relative; top:20px; left:6px; padding:0px; background: #D5DFE5; width:122px; height:112px; }
#templateModalImage img { border: #D5DFE5 1px solid; }
/* following TOP is driven by previous TOP, just offset by 3px */
.imageShadow { position:relative;top:17px;left:6px; }
/* following TOP is driven by previous TOP, just offset by 3px */
.templateModalData { position:absolute; top:14px; left:146px; padding-left:30px; text-align:left; font:10px verdana,arial,helvetica; }
.templateModalData div { padding-left:7px; background: url(/web_design_imagery/graphical-user-interface-arrow_off.gif) no-repeat 0px 3px; text-align:left; font-weight:normal; }
.templateModalData div.spanned { background-position:0px 6px; }
.templateModalData div div { line-height:12px; margin-top:0px; background: none; }
.templateModalData div div.fb-like { margin:0; }
.templateModalData div div div { padding-left:0px; }
/*contact info*/
.templateModalData div div div { line-height:18px; padding-bottom:6px; }
.templateModalDasher { padding-right:10px; background: none; }

.templateOptionsData { width:100%; text-align:left; font-weight:normal; }
.templateOptionsData span { font-size:10px; background:#F8F9FA; border: 1px solid #E1E3EC; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; color: #000000; cursor: default; display: block; float: left; height: 19px; margin: 3px 0 3px 3px; padding: 0 2px; position: relative; white-space: nowrap; }
.ContactOptionItem, .ContactOptionItem:hover { color:#000000; text-decoration:none; margin-left: 4px; }
.delete { margin: 2px 0 -4px 1px; outline: none; }
.miniclose { cursor: pointer; display: inline-block; padding:1px; margin-top: 2px; margin-left: 4px; background-image: url(/web_design_imagery/graphical-user-interface-delete_off.gif); background-repeat: no-repeat; height: 11px; width: 11px; border:1px solid #D5DFE5; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; }
.miniclose:hover { padding:1px; background-image: url(/web_design_imagery/graphical-user-interface-delete_over.gif); border:1px dashed #D5DFE5; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; }





.activeUserData span { font-size:11px; background:transparent; border: none; padding: 1px 3px 1px 3px; color: #555555; cursor: default; display: block; float: left; height: 19px; margin: 3px 0 3px 0; position: relative; white-space: nowrap; }
.activeUserData span:hover { cursor:pointer; border: none; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; padding: 1px 3px 1px 3px; }

span .userarrow, span .userconfig { margin: 0; outline: none; }
.activeUserData span .userarrow { cursor: pointer; display: inline-block; padding:2px; margin-top: 1px; margin-left: 1px; background: url(/web_design_imagery/website_design_communications/arrow-dark.png) -1px 0px no-repeat; height: 9px; width: 9px; border:none; }
.activeUserData span:hover .userarrow { padding:2px; background: url(/web_design_imagery/website_design_communications/arrow-dark-over.png) -1px 0px no-repeat; border:none; }

.activeUserData span .userconfig { cursor: pointer; display: inline-block; padding:0; background: url(/web_design_imagery/website_design_communications/gear_dark.png) 0 1px no-repeat; height:17px; width:16px; border:none; }
.activeUserData span:hover .userconfig { background: url(/web_design_imagery/website_design_communications/gear_dark_dropdown.png) 0 1px no-repeat; border:none; height:17px; width:16px; }
.activeUserData span.config { padding: 1px 3px 1px 3px; }
.activeUserData span.config:hover { border:0; padding: 1px 3px 1px 3px; }

#CommunicationsLogin { border:0;margin:0;padding: 3px 2px 2px 4px; }

/* old clearfix *//* .clearfix::after { visibility: hidden; clear: both; display: block; line-height: 0; height: 0; font-size: 0; content: "."; } */
/* new clearfix */
.clearfix:after { visibility: hidden; display: block; font-size: 0; content: " "; clear: both; height: 0; }
* html .clearfix             { zoom: 1; } /* IE6 */
*:first-child+html .clearfix { zoom: 1; } /* IE7 */

/*Virtual Private Servers and Networks Communications Panel*/
#VirtualPrivateServersURLs { width:90%;margin:0;padding:0;cursor:pointer; }
#VirtualPrivateURLs, #VirtualPrivateURL { font-family:arial,tahoma,helvetica; font-size:9px; line-height:12px; }
#VirtualPrivateURLs { color:#000000; }
#VirtualPrivateURLs:hover { color:#3F8FBD; cursor:pointer; }
#VirtualPrivateURL { padding:3px;padding-top:2px;width:100%;cursor:pointer; }
#MoreVirtualPrivateNetworks { width:93%; margin:0; padding:0; padding-right:7%; }
#CopyVirtualPrivateServers {  margin-left:10px; float:left; text-align:left; }
#OtherVirtualPrivateServersLinks { margin-right:10px; float:right; text-align:right; }



span.DefaultOptionsMenu { border:#FFFFFF 1px dashed; background:none; }

#chat-sales { padding-bottom:10px; }

#comments-form-message { padding: 5px 5px 5px 30px; width:auto; display: block; text-align:left; border: 1px dashed #AAB19E; margin:0; color:#000000; font-size: 11px; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; }
#comments-form-message.comments-form-message-error { border: 1px dashed #E98D8D; }
.comments-form-message-error {background: #F5CCCC url(/web_design_imagery/website_design_communications/icon_error.png) no-repeat 6px 3px; }
.comments-form-message-info {background: #F9F9F9 url(/web_design_imagery/website_design_communications/icon_info.png) no-repeat 6px 3px; }
.comments-form-message-optin {background: #F9F9F9 url(/web_design_imagery/website_design_communications/icon_email.png) no-repeat 6px 3px; }
.comments-form-message-time {background: #F9F9F9 url(/web_design_imagery/website_design_communications/icon_time.png) no-repeat 6px 3px; }
.comments-form-message-contact-added {background: #F9F9F9 url(/web_design_imagery/website_design_communications/virtual-private-contact-added.png) no-repeat 6px 3px; }

</style>
<script language="javascript" type="text/javascript" src="/cross_browser_javascripts/javascript-library-jquery-1.4.2.min.js"></script>
<script language="javascript" type="text/javascript" src="/cross_browser_javascripts/javascript-jquery-extension_bubblepopup.v2.3.1.min.js"></script>
<script language="javascript" type="text/javascript" src="/cross_browser_javascripts/javascript-yui-extension-container_core-min.js"></script>
<script language="javascript" type="text/javascript" src="/cross_browser_javascripts/javascript-yui-extension_connection-min.js"></script>
<script language="javascript" type="text/javascript" src="/interface_design_templater.php?q=1&p=CHS"></script>
<script>
/* document/source variables */
	//var QueryString = '$ENV{'QUERY_STRING'}';
	//var titleLink = '<span style="position:relative;top:2px;left:0px;"><a href="javascript:addBookmark(\\\''+appLoc+'?'+QueryString+'\\\', \\\'WikiPeeks ('+source+') '+myTitle+'\\\');" onMouseOver="iHover(this.firstChild,1);" onMouseOut="iHover(this.firstChild,0);" title="Add to Favorites: ('+source+') '+myTitle+'"><img src="/web_design_imagery/WikiBarLink-off.gif" width="14" height="14" border="0" alt="Add to Favorites: ('+source+') '+myTitle+'" name="WikiBarLink" id="WikiBarLink"></a><span> &nbsp;</span>';
	//if (myTitle == '') { titleLink = ''; }
	var loadImage = '<span style="position:relative;top:2px;left:0px;" title="Loading, please wait..."><img src="/web_design_imagery/loadCircle.gif" width="18" height="15" border="0" alt="Loading, please wait..."></span>';
	var hasClicked = 0;
	var runClick = function(quien,action) {
		hasClicked = 1;
		// none is associated with final run, meaning buttons not available, hidden+disabled
		if (quien!='none') { 
			quien.value = action; 
			document.VirtualPrivateComment.CanvasSubmit.disabled = 1;
			document.VirtualPrivateComment.CanvasCancel.disabled = 1;
		}

		if (action == 'Canceling' || action == 'Virtual-Private-Wave') {
			$closeAct
		}
$processingScript
$closingScript
};

\$(document).ready(function() {
	if (!(!parent.document.getElementById("Document-Title"))) {
		parent.document.getElementById("Document-Title").innerHTML = '$whichDocTitle';
	}
	else if (!(!document.getElementById("Document-Title"))) {
		document.getElementById("Document-Title").innerHTML = '$whichDocTitle';
	}
});

~;

##-- for ajax form submission calls
if ($myact eq "question" || $myact eq "service" || $myact eq "share" || $myact eq "ContactVirtualPrivate") {
	print qq~
		var ec = 0;
		var VirtualPrivateCommentActions = '';
		var stcf = function() {
			// save default actions to revert to
			if (VirtualPrivateCommentActions == '') { VirtualPrivateCommentActions = \$('#VirtualPrivateCommentActions').html(); }
			var formObject = document.getElementById('VirtualPrivateComment');
			YAHOO.util.Connect.setForm(formObject);

			doUnload();
			document.getElementById("VirtualPrivateActivity").innerHTML = loadImage;
			var callback = {
				success: function(o) {
					if(o.responseText !== undefined) {
						// another+selection | message+invalid|short
						if ((o.responseText.indexOf('selection') != -1 && o.responseText.indexOf('another') != -1) || (o.responseText.indexOf('message') != -1 && (o.responseText.indexOf('invalid') != -1 || o.responseText.indexOf('short') != -1))) {
							actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>');
							if (o.responseText.indexOf('selection') != -1) { document.VirtualPrivateComment.VirtualPrivateSelectorOutput.focus(); }
							else { document.VirtualPrivateComment.VirtualPrivateComments.focus(); }
						}
						else {
							if (o.responseText.indexOf('will be sent using') != -1 || o.responseText.indexOf('will be submitted using') != -1 || o.responseText.indexOf('will be saved using') != -1) {
								cualActivity = 'submit';
								if (o.responseText.indexOf('will be submitted using') != -1) {
									pueResponse = o.responseText.replace('Canvas will be submitted using <b>','').replace('</b>','');
								}
								else if(o.responseText.indexOf('will be saved using') != -1) {
									pueResponse = o.responseText.replace('Canvas will be saved using <b>','').replace('</b>','');
									cualActivity = 'save';
								}
								else {
									pueResponse = o.responseText.replace('Message will be sent using <b>','').replace('</b>','');
								}
								actionMessage('<div id="comments-form-message" class="comments-form-message-info">'+o.responseText+'</div>');
								\$("#UserSettings").html('');
								\$("#UserSettings").html('<span style="position:relative;top:-4px;right:-3px;" onClick="javascript:ec=2;if (hasClicked == 0) { return runClick(document.VirtualPrivateComment.CanvasSubmit,submitActive); }"><span style="padding:0 4px 3px 0;">'+pueResponse+'</span><a class=\"userconfig\"></a></span>');
								\$("#CommunicationsLogin").hide();
								submitAct = 'Yes, '+cualActivity+' it';
								// set the consent to positive [for use by stcf]
								ec = 1;
								// cancel being the only alternative
								cancelAct = 'Nevermind, cancel';
							}
							else if (o.responseText.indexOf('will need your contact information') != -1) {
								\$('.UserStatus').HideAllBubblePopups();
								\$("#UserSettings").hide();
								\$("#CommunicationsLogin").show();
								//4500
								actiontimer = 2800;
								actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>');
							}
							else if (o.responseText.indexOf('TryAgain!') != -1) {
								actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>');
							}
							else if (o.responseText.indexOf('Account Used') != -1 || o.responseText.indexOf('Contact Info Used') != -1) {
								if (o.responseText.indexOf('by OpenCanvas') != -1) {
									if (o.responseText.indexOf('to Save') != -1) {
										myResponse = 'Canvas was successfully saved, check your email to confirm.';
										actiontimer = 2900;
									}
									else {
										myResponse = 'Canvas was successfully submitted, we will get back to you shortly.';
										actiontimer = 3000;
									}
								}
								else {
									myResponse = 'Message successfully sent, we thank you for your correspondence.';
									//set actiontimer to 2700 truly final process, close window
									actiontimer = 2700;
								}
								actionMessage('<div id="comments-form-message" class="comments-form-message-info">'+myResponse+'</div>');
							}
							else if (o.responseText.indexOf('Good!') != -1) {
								actiontimer = 2600;
								o.responseText = o.responseText.replace('Good!','');
								actionMessage('<div id="comments-form-message" class="comments-form-message-contact-added">'+o.responseText+'</div>');
								document.VirtualPrivateComment.VirtualPrivateComments.value = '';
							}
							// error if matches nothing
							else { actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>'); }
						}
						//-- reset viewport title
						if (!(!wbct) && (wbct!=0)) { wbct.innerHTML = '<span style="font-weight:normal;position:relative;left:-4px;top:0px;">- $elTitulo</span>'; }
					}
					//-- anything else, including uncaught errors, are by-passed [end-less loop for user, no errors, no verification just a click through loop]
					else { enableCom(); }
				},
				failure: function(o) {
					enableCom();
					actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>');
					//-- reset viewport title
					if (!(!wbct) && (wbct!=0)) {
						wbct.innerHTML = '<span style="font-weight:normal;position:relative;left:-4px;top:0px;">- Request Error</span>';
					}
				}
			};
	        window.setTimeout(function() {
    	        var sUrl = "/customer-communication-panel.htm";
        	    // sample: '$myact=' + ((Dom.get('filter').checked) ? 'yes' : 'no') + '&whatever=' + encodeURIComponent(VirtualPrivateComment.get('SubjectSelection').value);
        	    // var data = 't=$template&v=$version&$myact='+encodeURIComponent(document.VirtualPrivateComment.$myact.value)+'&ss=' + encodeURIComponent(document.VirtualPrivateComment.SubjectSelection.value)+'&vps=' + encodeURIComponent(document.VirtualPrivateComment.VirtualPrivateComments.value)+'';
            	var request = YAHOO.util.Connect.asyncRequest('POST', sUrl, callback, 'ocso=1&ec='+ec+'');
        	}, 200);
		};
		
		var actiontimer = 5000;
		var refreshActions = function(callback) {
	        window.setTimeout(function() {
				\$('#comments-form-message').fadeTo('fast','0.00',function(){
					\$('#VirtualPrivateCommentActions').fadeTo('fast','0.00',function(){
						\$(this).html(VirtualPrivateCommentActions).fadeTo('fast','0.00', function(){
							// otherwise is default 5000 timer, enableCom
							if (actiontimer == 5000 || actiontimer == 100) {
								actiontimer = 5000;
								enableCom();
								\$(this).fadeTo('slow','1.00', callback);
							}
       						//final timer at 2700, triggers new actions
							// canvas: 2900 = saved | 3000 = submitted
							else if (actiontimer == 2700 || actiontimer == 2900 || actiontimer == 3000) {
								\$(this).fadeTo('fast','0.00', function() {
									whichMensage = 'We will now be closing this form, thanks again for your correspondence.';
									if (actiontimer == 2900 || actiontimer == 3000) { whichMensage = 'We will now be closing this form, thanks again for using OpenCanvas.'; }
									\$(this).html('<div id="comments-form-message" class="comments-form-message">'+whichMensage+'</div>');
									\$(this).fadeTo('slow','1.00', function() {
										\$(this).fadeTo(2500,'0.00', function() {
											//reset action timer
											
											if (actiontimer == 2900) {
												if (!(!parent.activeTemplates)) { 
													parent.CanvasSaved();
												}
											}
											if (actiontimer == 3000) {
												if (!(!parent.activeTemplates)) { 
													parent.CanvasSubmitted();
												}
											}
											actiontimer = 5000;
											runClick('none','Virtual-Private-Wave');
										});
									});
								});
							}
       						//show correspondence form
							else if (actiontimer == 2600) {
								\$(this).fadeTo('fast','0.00', function() {
									\$(this).html('<div id="comments-form-message" class="comments-form-message-info">Feel free to continue sharing, we love showing off our work!</div>');
									\$(this).fadeTo('slow','1.00', function() {
										\$(this).fadeTo(2500,'0.00', function() {
			
											correspondenceForm('$netAgent');

											submitAct = submitActDEFAULT;
											submitActive = submitActiveDEFAULT;
											cancelAct = cancelActDEFAULT;


											// yep reset buttons, running 100 timer
											actiontimer = 100;
											refreshActions();
										});
									});
								});
							}
       						// contact info timer at 2800, triggers new actions
							else if (actiontimer == 2800) {
								\$(this).fadeTo('fast','0.00', function() {
									\$(this).html('<div id="comments-form-message" class="comments-form-message-info">Please fill out the following contact form in its entirety to continue.</div>');
									\$(this).fadeTo('slow','1.00', function() {
										\$(this).fadeTo(2500,'0.00', function() {
											//set ec [EmailConsent] to 3, our next process in line
											ec = 3;
											//reset action timer
											contactInformationForm('VPSNETFirst','$netAgent');
											// yep reset buttons, running 100 timer
											actiontimer = 100;
											refreshActions();
										});
									});
								});
							}
						});
					});
				});
        	}, actiontimer);
		};
		var actionMessage = function(mymessage) {

			// which one was flagged as bad
			if (mymessage.indexOf("TryAgain!") != -1) {
				mymessage = mymessage.replace('TryAgain!','');
				if (mymessage.indexOf('first name') != -1) { document.VirtualPrivateComment["VPSNETFirst"].select(); }
				else if (mymessage.indexOf('last name') != -1) { document.VirtualPrivateComment["VPSNETLast"].select(); }
				else if (mymessage.indexOf('email') != -1) { document.VirtualPrivateComment["VPSNETEmail"].select(); }
			}

			if (VirtualPrivateCommentActions == '') { VirtualPrivateCommentActions = \$('#VirtualPrivateCommentActions').html(); }
			\$('#VirtualPrivateCommentActions').fadeTo('fast','0.00',function(){
				\$(this).html(mymessage).fadeTo('slow','1.00',function(){
    				refreshActions(function() {
						//okay now what
    				});
				});
			});
		};

		var submitActDEFAULT = '$submitAct';
		var submitActiveDEFAULT = '$submitActive';
		var cancelActDEFAULT = '$cancelAction';
		var submitAct = submitActDEFAULT;
		var submitActive = submitActiveDEFAULT;
		var cancelAct = cancelActDEFAULT;
		var enableCom = function() {
			document.getElementById("VirtualPrivateActivity").innerHTML = '';
			document.VirtualPrivateComment.CanvasSubmit.value = submitAct;
			document.VirtualPrivateComment.CanvasCancel.value = cancelAct;
			document.VirtualPrivateComment.CanvasSubmit.disabled = 0;
			document.VirtualPrivateComment.CanvasCancel.disabled = 0;
			hasClicked = 0;
		};
		
		var contactInformationForm = function(imsel,msie) {
			/*msie 8 AND LOWER has trouble with fading, revert to show/hide only */
			if (msie.indexOf("MSIE 5.") != -1 || msie.indexOf("MSIE 6.") != -1 || msie.indexOf("MSIE 7.") != -1 || msie.indexOf("MSIE 8.") != -1) {
				\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter').hide();
				\$('#ContactFieldset').show();
				document.VirtualPrivateComment[imsel].select();
			}
			else {
				\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter').fadeTo('slow','0.00',function() {
					\$(this).css('display','none');
					\$('#ContactFieldset').fadeTo('fast','0.00',function(){
						//\$('#VirtualPrivateCommentActions').attr('align','center');
						\$(this).css('display','block').fadeTo('slow','1.00');
						document.VirtualPrivateComment[imsel].select();
					});
				});
			}
		};
		
		var correspondenceForm = function (msie) {
			/*msie 8 AND LOWER has trouble with fading, revert to show/hide only */
			if (msie.indexOf("MSIE 5.") != -1 || msie.indexOf("MSIE 6.") != -1 || msie.indexOf("MSIE 7.") != -1 || msie.indexOf("MSIE 8.") != -1) {
				\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter, #VirtualPrivateCommentActions').show();
				\$('#ContactFieldset').hide();
			}
			else {
				if (!(!\$('#ContactFieldset'))) {
					\$('#ContactFieldset').fadeTo('slow','0.00',function() {
						\$(this).css('display','none');
						\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter, #VirtualPrivateCommentActions').fadeTo('fast','0.00',function(){
							\$(this).css('display','block').fadeTo('slow','1.00');
						});
					});
				}
				else {
					\$(this).css('display','none');
					\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter, #VirtualPrivateCommentActions').fadeTo('fast','0.00',function(){
						\$(this).css('display','block').fadeTo('slow','1.00');
					});
				}
			}
			// [WORKS PERFECTLY AS IT SITS] was thinking about switching process back to ec=1, step one, but really no need, for now
			// ec = 2;
			//\$(this).fadeTo('slow','1.00', callback);
		}
		
		var panelView = function(content) {
			\$('#content').fadeTo('slow','0.00',function() {
				\$('#panel').css('display','block').fadeTo('slow','1.00',function(){
					\$(this).html('<div id="panelContent">'+content+'</div>').css('display','block').fadeTo('slow','1.00');
				});
			});
		};
		
	~;
}


	$defaultOptionsOutput = "Selecting last item populates list with more options.";
	if ($myact && ($myact eq "question" || $myact eq "service" || $myact eq "share")) {


		## question and service
		if ($myact eq "share") {
			push(@selectors,"Share this website");
		}
		else {
			push(@selectors,"General Inquiry");
			##-- only if logged in do we give them TS and CS options (checked by cookiesnif.nsp)
			if ($ISIN ne "") {
				push(@selectors,"Technical Support");
				push(@selectors,"Customer Service");
			}
		}

		if ($myact eq "question" || $myact eq "share") {
			if (($template =~ m/ocv/i) && length($template) > 5 && int($CualOC) > 0) {
				$open_canvas_package = "$losCanvasPacks[$CualOC]";
				push(@specificSelectors,"- OC".$CualOC." (".$losCanvasPacks[$CualOC].")");
			}
			push(@specificSelectors,"- Design ID: $trueTN");
			push(@specificSelectors,"- Canvas ID: $idHash");
		}
		
		if ($myact eq "service" || $myact eq "share") {
			push(@specificSelectors,"- OpenCanvas (Interactive Web Design Experience)");
			#- push(@specificSelectors,"- SEM (Search Engine Marketing)");
			#- push(@specificSelectors,"- SEO (Search Engine Optimization)");
			if ($myact eq "share") {
				##push(@specificSelectors,"- Techie (Technical Tutorials & Resources)");
				push(@specificSelectors,"- Tools (Website Tools & Widgets)");
				push(@specificSelectors,"- HTML-O (HTML Obfuscator)");
			}
			push(@specificSelectors,"- Domains (Domain Name Search)");
			push(@specificSelectors,"- BuyItNow (Wordpress E-Commerce Plugin)");
			#- push(@specificSelectors,"- MITe (Master Information Technology Engineering)");
			#- push(@specificSelectors,"- WikiPeeks (Internet Wiki Plug-In for Websites)");
		}

		if (@specificSelectors) {

			if ($myact eq "share") {
				push(@selectors,"Specific Products, Services or Content...");
			}
			else {
				push(@selectors,"Specific Products or Services...");
			}
			$sselor = join('","',@specificSelectors);
		}

		print qq~var specificSelectors = new Array("$sselor");~;
		if (@selectors) {
			$selor = join('","',@selectors);
			print qq~var selectors = new Array("$selor");~;
		}


		##-- how many multiples can we select, term(s)
		##-- max selectable is always 4, but since common lists only contain 3 sub-items, we just generalize its term
		$whatMultiple = 'multiple';
		##-- default select list layout
		##-- only if logged in do we give them TS and CS options (checked by cookiesnif.nsp)
		if ($ISIN ne "") {
			##-- $losSelectorsMain items that reset our list, back to default
			$losSelectorsMain = "who == '$selectors[0]' || who == '$selectors[1]' || who == '$selectors[2]'";
			##-- $elSelectorItem is the list item that will trigger a repopulation action
			$elSelectorItem = $selectors[3];
		}
		##-- no CS or TS
		else {
			$losSelectorsMain = "who == '$selectors[0]'";
			$elSelectorItem = $selectors[1];
		}


		##-- SAME as no CS or TS, but we leave it here to make it easier to understand future-tense
		if ($myact eq "share") { 
			##-- max selectable is always 4, this sub-list contains more than 4 items, let user know how many they can select verbally
			$whatMultiple = 'up to four(4)';
			$losSelectorsMain = "who == '$selectors[0]'";
			$elSelectorItem = $selectors[1]; 
		}

		##-- all default selectors
		$losSelectors = "$losSelectorsMain || who == '$elSelectorItem'";
		$defaultOptionsOutput = "For more options select: <i>".$elSelectorItem."</i>";
	}

if ($myact && ($myact eq "question" || $myact eq "service" || $myact eq "share")) {
print qq~

var whosChanged = '';
var numberChanged = 0;
var defaultOption = '$defaultOptionsOutput';
var defaultOptionsOutput = '<span class="DefaultOptionsMenu">'+defaultOption+'</span>';
var multiChoice = '<span class="DefaultOptionsMenu">You may select $whatMultiple topics from: <i>$elSelectorItem</i></span>';
var multiValue = '$elSelectorItem';
var allSelectors = new Array();
var addToSubjects = function(who) {
	// if empty or selected main item 1-2 [main options]
	if (who == '' || $losSelectors) {
		// selected main item 1-2 [main options]
		if ($losSelectorsMain) {
			//reset list and tracking fields to original state
			document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = ''+defaultOptionsOutput+'';
			whosChanged = '';
			numberChanged = 0;
			document.VirtualPrivateComment.SubjectSelection.value = '';
			
			allSelectors = new Array();
			csel = 0;
			for (var i=0; i<selectors.length; i++) { allSelectors[csel] = new Option(selectors[i], selectors[i]); csel++; }
			reparseList(who);
		}
		// select main item 2 [more options: can select multiple items]
		else if (who == '$elSelectorItem') {
			// clear our workspace
			document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = ''+multiChoice+'';
			whosChanged = '';
			numberChanged = 0;
			document.VirtualPrivateComment.SubjectSelection.value = '';
			
			allSelectors = new Array();
			csel = 0;
			// repopulate list with all main options
			for (var i=0; i<selectors.length; i++) { allSelectors[csel] = new Option(selectors[i], selectors[i]); csel++; }
			// infuse list with more options list
			for (var i=0; i<specificSelectors.length; i++) { allSelectors[csel] = new Option(specificSelectors[i], specificSelectors[i]); csel++; }
			reparseList(who);
		}
	}
	else if (numberChanged <= 3) {
		// clear target first [only if it contains some load text in it]
		elInno = ""+document.getElementById("VirtualPrivateSelectorPrintout").innerHTML+"";
		// alert(elInno + ' ::::: ' + multiValue);
		// changed from multiChoice to multiValue, better
		if (elInno.indexOf(""+multiValue+"") != -1) { 
			document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = ''; 
		}
		who = who.replace('- ','');
		if (whosChanged.indexOf(" "+who+"") == -1) {
			whosChanged = whosChanged + ' ' + who;
			// compact view mode
			whoC = who;
			if (whoC.indexOf(" (") != -1) { who2 = whoC.split(" ("); whoC = who2[0]; }
			whoC = whoC.replace('Design ID: ','');
			whoC = whoC.replace('Canvas ID: ','');
			numberChanged++;
			//<img src="ci/nmi/bottomFrame_saveOn.gif" border="0" width="14" height="14" vspace="4" hspace="4" name="saveButton" style="cursor:pointer;" border="0" onMouseOver="if(this.src == saveOn.src) this.src = saveOnOver.src" onMouseOut="if(this.src == saveOnOver.src) this.src = saveOn.src">
			document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = document.getElementById("VirtualPrivateSelectorPrintout").innerHTML + '<span><a id="'+who+'" title="'+who+'" class="ContactOptionItem"><nobr>'+whoC+'<a class="miniclose delete" title="Remove '+who+'" onClick="removeFromChanged(\\''+who+'\\');"></a></nobr></span>';
			document.VirtualPrivateComment.SubjectSelection.value = whosChanged;
		}
	}

	// at this point we can change share URL according to 1st item chosen, anything else reverts back to default URL
	//if (numberChanged == 1) { setShareURL(who); }
	if (numberChanged >= 1) { setShareURL(who); }
	else {
		setShareURL(defaultOption);
	}

};

var reparseList = function(chosen) {
	OCSO = document.VirtualPrivateComment.VirtualPrivateSelectorOutput;
	var sizer = OCSO.length;
	for(var i = (sizer-1); i >= 0; i--) { OCSO.options[i] = null; }
	var sizer2 = OCSO.length;
	for (var i=0; i<allSelectors.length; i++) {
		OCSO.options[sizer2] = new Option(allSelectors[i].text);
		OCSO.options[sizer2].value = allSelectors[i].text;
		if (chosen != '' && chosen == allSelectors[i].text) {
			OCSO.options[sizer2].selected = 1;
		}
		sizer2++;
	}
};
var removeFromChanged = function(who) {
	if (whosChanged.indexOf(" "+who+"") != -1) {
		whosChanged = whosChanged.replace(" "+who+"","");
		numberChanged--;
		document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = '';
		for (var i=0; i<specificSelectors.length; i++) {
			mywho = ""+specificSelectors[i]+"";
			mywho = mywho.replace('- ','');
			if (whosChanged.indexOf(""+mywho+"") != -1) {
				whoC = mywho;
				if (whoC.indexOf(" (") != -1) { who2 = whoC.split(" ("); whoC = who2[0]; }
				whoC = whoC.replace('Design ID: ','');
				whoC = whoC.replace('Canvas ID: ','');
				document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = document.getElementById("VirtualPrivateSelectorPrintout").innerHTML + '<span><a id="'+mywho+'" title="'+mywho+'" class="ContactOptionItem"><nobr>'+whoC+'<a class="miniclose delete" title="Remove '+mywho+'" onClick="removeFromChanged(\\''+mywho+'\\');"></a></nobr></span>';
			}
		}
		document.VirtualPrivateComment.SubjectSelection.value = whosChanged;
	}
	// if no 'other/specific' item selections, revert back to default select list state and action message
	if (numberChanged == 0) {
		document.VirtualPrivateComment.SubjectSelection.value = '';
		reparseList('$selectors[0]');
		document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = ''+defaultOptionsOutput+'';
	}
	// at this point we can change share URL according to 1st item chosen, anything else reverts back to default URL
	if (numberChanged >= 1) {
		setShareURL(whosChanged);
	}
	else {
		setShareURL(defaultOption);
	}
	
};
var vps_net_address = '$vpsneturl';
var vps_net_selected_url = vps_net_address;

/* start wikiboard head script */
var shareloaded = 0;
var myaddthis = '';
var setVirtualPrivateURL = function(indice,sudomi) {
	if (numberChanged == 0) {
		indice = 'Virtual Private Servers and Networks';
		sudomi = 'http://www.vps-net.com/';
	}

	indice = indice.replace(/- /g,'');
	// opencanvas [\$price]
	if (indice.indexOf(" [") != -1 && indice.indexOf("]") != -1) {
		var indpartes = '';
		indpartes = indice.split(' [');
		indice = indpartes[0]+' Websites)';
	}
	indice = indice.replace('Canvas ID:','OpenCanvas');
	indice = indice.replace('Design ID:','OpenCanvas Design');


	if (numberChanged >= 1) {
		if (indice.indexOf(" (") != -1 && indice.indexOf(")") != -1) {
			var indpartuch = '';
			indpartuch = indice.split(' (');
			indice = indpartuch[1].replace(')','');
		}
	}

	var derFont = '';
	if (indice.length >= 40) { derFont = 'font-family:arial narrow, arial, tahoma;'; }
	\$("#VirtualPrivateTitles").html('<span style="'+derFont+'">'+indice+'</span>');
	\$("#VirtualPrivateURLs").hide('fast',function() {
		\$(this).html(''+sudomi+'');
		\$(this).show();
	});
	\$("#VirtualPrivateURLs").hover( function() {
	},function(){
	});

	if (numberChanged >= 1) {
		indice = '' + indice + ' by Virtual Private';
	}


~;





if ($myact eq "share") {
print qq~
		
		if (shareloaded == 0) {
			//\$("#Virtual-Private-Social-Networking").html('');
			//\$("#Virtual-Private-Social-Networking").hide();

			if (myaddthis != '') {
				//addthis = '';
				//myaddthis = '';
			} 
			myaddthis = runAddThis(1, indice, sudomi, function() {
				addthis_share = {url:"http://www.vps-net.com/"};
			 	addthis.ost = 0;
		    	addthis.ready();
				shareloaded=1;
				window.addthis = addthis;
			});
		}	
~;
}





print qq~
};

var setShareURL = function(seleccione) {
	var vpsnetshareurl = vps_net_address;
	var open_canvas_package = '$open_canvas_package';

	var packageone = 'express-web-design-package.php';
	var packagetwo = 'business-website-design-package.php';
	var packagethree = 'advanced-web-site-design-package.php';

	// OpenCanvas package
	// server(document) or script based positive
	// if more than one sub-item chosen, resort back to main url
	if (seleccione.indexOf('(OpenCanvas') != -1 || seleccione.indexOf('OpenCanvas (') != -1 || seleccione.indexOf('Design ID:') != -1 || seleccione.indexOf('Canvas ID:') != -1) {
		vpsnetshareurl += 'opencanvas-interactive-website-design/';
		// root calls
		if (seleccione.indexOf('Design ID:') != -1) { vpsnetshareurl += '?DesignID=$myFullTemplateNumber'; }
		else if (seleccione.indexOf('Canvas ID:') != -1) { vpsnetshareurl += '?OpenCanvasID=$idHash'; }
		// enhanced calls
		else {
			if (seleccione.indexOf('eXpress') != -1) { vpsnetshareurl += packageone; }
			//advanced before business for other way around would catch business first
			else if (seleccione.indexOf('Advanced') != -1) { vpsnetshareurl += packagethree; }
			else if (seleccione.indexOf('Business') != -1) { vpsnetshareurl += packagetwo; }
			else if (open_canvas_package.indexOf('eXpress') != -1) { vpsnetshareurl += packageone; }
			else if (open_canvas_package.indexOf('Advanced')) { vpsnetshareurl += packagethree; }
			else if (open_canvas_package.indexOf('Business')) { vpsnetshareurl += packagetwo; }
		}
	}
	else if (seleccione.indexOf('SEM') != -1) {
		vpsnetshareurl += 'internet-search-and-social-marketing/sem-search-engine-marketing.php';
	}
	else if (seleccione.indexOf('SEO') != -1) {
		vpsnetshareurl += 'internet-search-and-social-marketing/seo-search-engine-optimization.php';
	}
	else if (seleccione.indexOf('Domains') != -1) {
		vpsnetshareurl += 'domain-registration-search/';
	}
	else if (seleccione.indexOf('HTML-O') != -1) {
		vpsnetshareurl += 'internet-development-tools/html-data-obfuscation-web-tool.php';
	}
	else if (seleccione.indexOf('BuyItNow') != -1) {
		vpsnetshareurl += 'internet-development-tools/wordpress-plugins/buy-it-now-button.php';
	}
/*
	else if (seleccione.indexOf('MITe') != -1) {
		vpsnetshareurl += 'proprietary-information-technology-engineering/';
	}
*/
	else if (seleccione.indexOf('Tools') != -1) {
		vpsnetshareurl += 'internet-development-tools/';
	}
/*	else if (seleccione.indexOf('Techie') != -1) {
		vpsnetshareurl += 'information-technology-web-development/';
	}
*/
	else if (seleccione.indexOf('WikiPeeks') != -1) {
		vpsnetshareurl += 'internet-development-tools/cross-browser-javascripting/wiki-peeks/';
	}

	//- OC".$CualOC." (".$losCanvasPacks[$CualOC].")
	
	// update zopim chat status notes, perfect :)
	tryZopim();

	vps_net_selected_url = vpsnetshareurl;
	setVirtualPrivateURL(seleccione,vps_net_selected_url);
};

var tryZopim = function() {
	$zopimActive
};
~;
}

print qq~





// all communications/forms get caughtEscape functionality
var caughtEscape = 0;
var imFocused = '';
function checkEscape(e,val) {
	if(!e) var e = window.event;
	if (e.which) { key = e.which; }
	else if (e.keyCode) { key = e.keyCode; }
	var eValue = val.value;
	if (caughtEscape == 0 && key == 27) {
		imFocused = \$("*:focus").attr("id");
		caughtEscape = 1;
		\$("#processKiller").show('fast');
		\$("#YesClose").focus();
		// hide zopim by moving down out of view [no need for it anymore, changed z-index for processKiller to 100000000 [topping zopim]]
		//\$(".zopim").animate({"bottom": "-=40px"}, "fast");
	}
	//-- if showing close: yes/no option, and escapes, hide the prompt
	else if (caughtEscape == 1) { runEscape('No'); }
}

function runEscape(way) {
	if (way == 'No') {
		caughtEscape = 0;
		\$("#processKiller").hide('fast');
		// focus on last element being focused on to begin with
		\$("#"+imFocused+"").focus();
		imFocused = '';
	}
	else {
		if (!(!parent.fancyLoad)) { parent.\$.fancybox.close(); } 
		else { $MYCLOSER2 }
	}
}

</script>
</head>
<body style="margin:0;padding:0;" onbeforeunload="doUnload();" onload="$feedbackScript" onKeyUp="return checkEscape(event, this);">
<div id="processKiller"  style="display:none;cursor:wait;z-index:100000000;width:100%;position:absolute;right:0px;top:0px;visibility:$processLoadVisibility;background-color:#FFFFFF;width:100%;height:100%;overflow:hidden;">
			<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
				<tr valign="middle"><td width="100%">
					<table width="100%" border="0" cellpadding="0" cellspacing="0">
						<tr style="cursor:wait;"><td width="100%" bgcolor="#C9CDDF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);" title="Virtual Private Servers - VPS"><img src="/web_design_imagery/spacie.gif" height="1" width="1" border="0" alt="Virtual Private Servers - VPS"></div></td></tr>
						<tr style="cursor:wait;"><td width="100%" bgcolor="#FFFFFF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);" title="Virtual Private Networks - VPN"><img src="/web_design_imagery/spacie.gif" height="1" width="1" border="0" alt="Virtual Private Networks - VPN"></div></td></tr>
						<tr style="cursor:wait;"><td width="100%" align="center" id="net" style="color:#333333;font-family:verdana,arial;font-size:12px;line-height:20px;" title=". . . OpenCanvas by VPS-NET, coming soon . . ." valign="top"><div style="padding:20px;">Close $elTitulo?</div></td></tr>
						<tr>
							<td width="100%" align="center" style="padding: 0 0px 20px 0px;"><form onSubmit="return false;"><button id="YesClose" onClick="return runEscape('Yes');">Yes</button><button onClick="return runEscape('No');">No</button></form></td>
						</tr>
						<tr style="cursor:wait;"><td width="100%" bgcolor="#FFFFFF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);" title="Application Programming Interface - API"><img src="/web_design_imagery/spacie.gif" height="1" width="1" border="0" alt="Application Programming Interface - API"></div></td></tr>
						<tr style="cursor:wait;"><td width="100%" bgcolor="#C9CDDF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);" title="Search Engine Optimization - SEO"><img src="/web_design_imagery/spacie.gif" height="1" width="1" border="0" alt="Search Engine Optimization - SEO"></div></td></tr>
					</table>
				</td></tr>
			</table>
</div>
<a name="topmost" id="topmost"></a>
$userStatus
<div>
<div style="text-align:left;padding:15px;">
<div id="content">
~;

print qq~
<form name="VirtualPrivateComment" id="VirtualPrivateComment" method="post" action="?" onSubmit="if (hasClicked == 0) { return runClick(document.VirtualPrivateComment.CanvasSubmit,'$submitActive'); }">
<input name="$myact" type="hidden" value="$myactstate">
<input name="t" type="hidden" value="$template">
<input name="v" type="hidden" value="$version">
<div class="VirtualPrivateCommentWrapper">
	<div class="VirtualPrivateCommentFormContainer">
~;



$theX = '<input name="x" type="hidden" value="0">';
$TAti = '1';
$hideSubjectMatter = '';
$templateModalImage = "<div id=\"templateModalImage\"><a href=\"javascript:$templateScript\"><img src=\"/opencanvas-interactive-website-design/website-design-template-images.htm?t=$trueTN&k=t&s=tm\" width=\"120\" height=\"110\" border=\"0\"></a></div><div class=\"imageShadow\"><img src=\"/web_design_imagery/carouselImageShadow.png\" width=\"122\" height=\"10\" border=\"0\"></div>";

if ($myact eq "question" || $myact eq "service" || $myact eq "share") {
	$losSelections = "";
	foreach $unsel (@selectors) { $losSelections = $losSelections . "<option value=\"$unsel\">$unsel</option>"; }
	
	$subjectTitle = 'Message subject:';
	if ($myact eq "share") {
		$subjectTitle = 'What would you like to share?';
	}
	##-- 11111 = SaveCanvas || 22222 = SubmitCanvas
	elsif ($template =~ "11111" || $template =~ "22222") {
		$subjectTitle = '';
		$hideSubjectMatter = 'display:none;visibility:hidden;';
		
		$elPaquetazo = 'express';
		$elPaquetazoTitle = "OpenCanvas eXpress Interactive Design Package";
		if ($version eq "2") { 
			$elPaquetazo = 'business'; 
			$elPaquetazoTitle = "OpenCanvas Business Interactive Design Package";
		}
		elsif ($version eq "3") { 
			$elPaquetazo = 'advanced'; 
			$elPaquetazoTitle = "OpenCanvas Advanced Interactive Design Package";
		}

		$templateModalImage = "<div style=\"position:relative;left:-5px;top:18px;\"><a title=\"$elPaquetazoTitle\"><img src=\"/website_design_template_images/opencanvas-interactive-$elPaquetazo-website-design-package.png\" width=\"101\" height=\"102\" border=\"0\" align=\"right\" style=\"margin:10px 25px 0 25px;\" alt=\"$elPaquetazoTitle\"></a></div>";
	}

	print qq~
	<div id="VirtualPrivateSubjectMatter" style="$hideSubjectMatter">
		<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VirtualPrivateSelectorOutput" id="label_VirtualPrivateSelectorOutput">$subjectTitle</label></div>
		<div id="VirtualPrivateSelectorOutputWrap"><select name="VirtualPrivateSelectorOutput" id="VirtualPrivateSelectorOutput" class="VirtualPrivateSelectorOutput" tabindex="1" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);addToSubjects(this.options[this.selectedIndex].value);" onChange="addToSubjects(this.options[this.selectedIndex].value);" onKeyUp="addToSubjects(this.options[this.selectedIndex].value);">$losSelections</select></div>
		<div id="VirtualPrivateSelectorPrintout" class="templateOptionsData clearfix"><span class="DefaultOptionsMenu">$defaultOptionsOutput</span></div>
		<input type="hidden" name="SubjectSelection" id="SubjectSelection" value="">
	</div>
	~;
	$theX = '';
	$TAti = '2';
}
$TAtiS = int($TAti)+1; $TAtiR = int($TAti)+2;


if (!$losComments) { $losComments = ""; }

if ($ISUNROUTED == 1){ $TAti = 2; }

print qq~
	<div id="VisualSwapOne">
		<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VirtualPrivateComments" id="label_VirtualPrivateComments">$feedback</label></div>
		<div id="TemplateCommentAreas"><textarea name="VirtualPrivateComments" id="VirtualPrivateComments" class="VirtualPrivateCommentTextarea" tabindex="$TAti" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);">$losComments</textarea>$theX</div>
	</div>
~;

if (($ISUNROUTED == 1 && $NEEDCONTACT == 1) || $SHOWCONTACT == 1){



	if ($ISUNROUTED == 1 && $NEEDCONTACT == 1) {
print qq~
<script language="javascript" type="text/javascript" src="/cross_browser_javascripts/phoneFormatter.js"></script>
<script language="javascript" type="text/javascript">
var incomingPHONE = '$VPSNETDID';
var shifting = 0;
function checkPhoneInput(e,val) {
	if(!e) var e = window.event;
	if (e.which) { key = e.which; }
	else if (e.keyCode) { key = e.keyCode; }
	var leValue = val.value;
	if ((key == 48 || key == 57) || (shifting == 0 && key > 48 && key < 57) || (shifting == 0 && key > 95 && key < 106) || (shifting == 0 && key > 36 && key < 41) || key == 27 || key == 46 || key == 8 || key == 9) { 
		leValue = val.value;
		return true;
	}
   	else if (key == 13 && incomingPHONE != val.value) {
		return true;
	}
   	else if (key == 16) {
		if (shifting == 0) { shifting = 1; }
		else { shifting = 0; }
		return true;
	}
	else {
		e.returnValue = null;
		return false;
	}
}
</script>
~;
	}


print qq~
<div id="ContactFieldset" style="display:none;">
<div style="padding-bottom:11px;">
<fieldset style="margin:0;padding:0;display:block;font-size:14px;width:100%;-moz-border-radius:3px; -webkit-border-radius:3px; border-radius:3px;">
	<legend style="padding:0 10px 0 10px;">Your Contact Information</legend>
	<div style="padding:10px;">
		<div style="padding-left:15px;">
			<div style="float:left;width:35%;">
				<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VPSNETFirst" id="label_VPSNETFirst">First Name</label></div>
				<div style="padding-bottom:12px;"><input type="text" name="VPSNETFirst" value="$FORM{'VPSNETFirst'}" id="VPSNETFirst" class="VirtualPrivateUser" tabindex="1" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);"></div>
			</div>
			<div style="float:left;width:65%;">
				<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VPSNETLast" id="label_VPSNETLast">Last Name</label></div>
				<div style="padding-bottom:12px;"><input type="text" name="VPSNETLast" value="$FORM{'VPSNETLast'}" id="VPSNETLast" class="VirtualPrivateUser" tabindex="2" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);"></div>
			</div>
		</div>

		<div id="ContactSwapTwo">
~;

if ($ISUNROUTED == 1 && $NEEDCONTACT == 1) {
print qq~
			<center>
				<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VPSNETDID" id="label_VPSNETDID" style="text-align:left;">Primary Phone Number</label></div>
				<div style="padding-bottom:9px;"><input type="text" name="VPSNETDID" value="$FORM{'VPSNETDID'}" id="VPSNETDID" class="VirtualPrivateUser" tabindex="3" maxlength="$cualMaxPhone" $myTriggerKeyDown="return checkPhoneInput(event, this);" onKeyUp="return checkPhoneInput(event, this);" onFocus="getIt(this);formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);checkFinalPHormat(this);"></div>
				<!--space difference in dynamic form change: height 23px smaller-->	
				<!--<div style="padding-bottom:20px;"><div style="height:20px;" class="comments-form-message-info">Cool</div></div>-->
			</center>
~;
}
elsif ($SHOWCONTACT == 1) {
$subjectTitle = 'Your Email Address:';
print qq~
			<center>
				<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VirtualPrivateUser" id="label_VirtualPrivateUser">$subjectTitle</label></div>
				<div id="VirtualPrivateSelectorOutputWrap" style="padding-bottom:20px;"><input type="text" name="VirtualPrivateUser" value="$previouslyUsedEmail" id="VirtualPrivateUser" class="VirtualPrivateUser" tabindex="3" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);"></div>
			</center>
~;
}

print qq~
		</div>
	</div>
</fieldset>
</div>
</div>
~;
}


$TAtiS = int($TAti)+1; $TAtiR = int($TAti)+2;
if ($ISUNROUTED == 1){
	$subjectTitle = 'Your Email Address:';
	print qq~
		<div id="VisualSwapTwo">
			<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VirtualPrivateUser" id="label_VirtualPrivateUser">$subjectTitle</label></div>
			<div id="VirtualPrivateSelectorOutputWrap" style="padding-bottom:20px;"><input type="text" name="VirtualPrivateUser" value="$FORM{'VirtualPrivateUser'}" id="VirtualPrivateUser" class="VirtualPrivateUser" tabindex="1" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);"></div>
		</div>
	~;
	$theX = '';
	$TAti = '3';
}


print qq~
		<div id="VirtualPrivateCommentActions" align="right"><span id="VirtualPrivateActivity"></span><span id="VirtualPrivateCommentButtons"><input type="submit" tabindex="$TAtiS" class="canvasButtons" name="CanvasSubmit" id="CanvasSubmit" style="padding:3px;padding-left:10px;padding-right:10px;font-size:12px;font-weight:bold;" value="$submitAct" /><input type="button" onClick="javascript:return runClick(document.VirtualPrivateComment.CanvasCancel,'$cancelAct');" tabindex="$TAtiR" class="canvasButtons" name="CanvasCancel" style="padding:3px;padding-left:8px;padding-right:8px;font-size:12px;" value="$cancelAction"/></span></div>
	</div>
</div>
<div id="infoWrap">
<table cellpadding="0" cellspacing="0" border="0" class="nobord" width="100%">
	<tr>
~;

##-- default size 145 x 133 ##-- <div id="templateModalImage" style="width:145px; height:133px;"> && <img src="/web_design_imagery/carouselImageShadow.png" width="147" height="10" border="0">
##-- sized down to 80 ##-- <div id="templateModalImage" style="width:80px; height:73px;"> && <img src="/web_design_imagery/carouselImageShadow.png" width="82" height="10" border="0">

print qq~
		<td class="nobord" align="left" valign="top">$templateModalImage</td>
		<td align="left" valign="bottom" width="100%">
			<div class="templateModalData">
~;




$mySocialNetworkPrint = '
				<div id="Virtual-Private-Social-Networking" class="addthis_toolbox addthis_default_style" style="margin:0;padding:0;height:28px;">
					    <span id="addthis_button_facebook_like"><a class="addthis_button_facebook_like" fb:like:layout="button_count" addthis:url="http://www.vps-net.com/opencanvas-interactive-web-design/" addthis:title="OpenCanvas Web Design by Virtual Private Servers & Networks" style="float:left;width:43px;height:21px;overflow:hidden;clip:rect(0px,43px,21px,0px);"></a></span>
					    <span id="addthis_button_tweet"><a class="addthis_button_tweet" addthis:url="http://www.vps-net.com/opencanvas-interactive-web-design/" addthis:title="OpenCanvas Web Design by Virtual Private Servers & Networks" style="margin-left:1px;float:left;width:57px;height:20px;overflow:hidden;clip:rect(0px,57px,20px,0px);"></a></span>
				    	<span id="addthis_button_google_plusone"><a class="addthis_button_google_plusone" addthis:url="http://www.vps-net.com/opencanvas-interactive-web-design/" addthis:title="OpenCanvas Web Design by Virtual Private Servers & Networks" style="margin-left:0px;float:left;width:32px;height:20px;overflow:hidden;clip:rect(0px,31px,20px,0px);" g:plusone:size="medium" g:plusone:expandto="top" id="gg"></a></span>
				    	<span id="addthis_counter"><a class="addthis_counter addthis_pill_style" style="margin-left:1px;float:left;padding-top:0px;width:84px;height:20px;overflow:hidden;clip:rect(0px,84px,20px,0px);" addthis:url="http://www.vps-net.com/opencanvas-interactive-web-design/" addthis:title="OpenCanvas Web Design by Virtual Private Servers & Networks"></a></span>
				</div>
<script type="text/javascript">
	$(document).ready(function() {
		myaddthis = runAddThis(0, \'OpenCanvas Web Design by Virtual Private Servers & Networks\', \'http://www.vps-net.com/opencanvas-interactive-web-design/\');
	});

	var lastTat = "";
	var runAddThis = function(rackit, tit, tat) { 
		// load only once per item, mouse focus/blur/click/select, nah just one is good :P
		if (lastTat != tat) {
			addthis_share = {url:tat,title:tit};

			if (rackit == 1) {
				var add_this_FB = \'<a class="addthis_button_facebook_like" fb:like:layout="button_count" addthis:url="\'+tat+\'" addthis:title="\'+tit+\'" style="float:left;width:43px;height:21px;overflow:hidden;clip:rect(0px,43px,21px,0px);"></a>\';
	    		var add_this_TW = \'<a class="addthis_button_tweet" addthis:url="\'+tat+\'" addthis:title="\'+tit+\'" style="margin-left:1px;float:left;width:57px;height:20px;overflow:hidden;clip:rect(0px,57px,20px,0px);"></a>\';
		    	var add_this_GP = \'<a class="addthis_button_google_plusone" addthis:url="\'+tat+\'" addthis:title="\'+tit+\'" style="margin-left:0px;float:left;width:32px;height:20px;overflow:hidden;clip:rect(0px,31px,20px,0px);" g:plusone:size="medium" g:plusone:expandto="top" id="gg"></a>\';

		    	$("#addthis_button_facebook_like").html("");
		    	$("#addthis_button_tweet").html("");
	    		$("#addthis_button_google_plusone").html("");
	    		$("#addthis_button_facebook_like").html(add_this_FB);
		    	$("#addthis_button_tweet").html(add_this_TW);
		    	$("#addthis_button_google_plusone").html(add_this_GP);

				addthis.toolbox(".addthis_toolbox");
			}
	    	$.getScript("http://s7.addthis.com/js/300/addthis_widget.js",function(){
       			addthis.init();
		    });  
 			$.getScript("https://apis.google.com/js/plusone.js");
		}
		lastTat = tat;
	};

</script>
';


##-- cs {company contact info}
if ($myact eq "question" || $myact eq "service" || $ISINTERNAL) {
	print qq~<div class="spanned"><div><div><b>Virtual Private Servers and Networks</b><br>Southern California, United States<!--<br>1840 Lincoln Boulevard<br>Santa Monica, California 90404--><br><span><a class=\"Call-Virtual-Private-VPS-NET\" title=\"$whoReach can be reached by calling $whichNumberVanity, or $whichNumberDID $guruText\" style=\"cursor:help;text-decoration:none;\" $guruScript>$whichNumberVanity, or $whichNumberDID</a></div></div></div>~;

	## only for stated ACTs (for zopim chat/email/communication panel)
	## NOT for UNLOGGED/UNROUTED USERS (UNROUTED = NO OPENCANVAS, FEET NOT WET)
	if ($myact ne "" && $myact ne "ContactVirtualPrivate") {
		print qq~<div id="chat-sales"><div><b>Need quicker service?</b> <em>Chat with a tech:</em></div></div>~;
	}

	## non stated ACT (general communication)
	#else {
	#	print qq~
	#			<div style="clear:both;">
	#				<div>Share VPS-NET by using:</div>
	#				<div style="width:246px;">
	#					$mySocialNetworkPrint
	#				</div>
	#			</div>	
	#	~;
	#}
	
}
##-- sharing
elsif ($myact eq "share") {
print qq~
				<div style="clear:both;">
					<div>You can also share us by using:</div>
					<div style="width:246px;">
						$mySocialNetworkPrint
					</div>
				</div>
				<div style="clear:both;">
					<div>
						OR, you can copy a link to:
						<div style="margin-top:4px;padding:0px;font-size:10px;">
							<div class="VirtualPrivateURLOut" style="margin:0;padding:0;"><span id="VirtualPrivateTitles" style="font-weight:bold;">Virtual Private Servers and Networks</span></div>
							<table width="100%" cellpadding="0" cellspacing="0" border="0">
								<tr>
									<td><div class="VirtualPrivateURLOut" style="margin:0;padding:0;"><img src="electronic-communications/spacer.gif" width="1" height="10" border="0"></div></td>
									<td><div id="VirtualPrivateURLs" style="margin:0;padding:0;"><span style="position:relative;top:1px;left:5px;">$vpsneturl</span></div></td>
									<td><div class="VirtualPrivateURLOut" style="margin:0;padding:0;"><img src="electronic-communications/spacer.gif" width="1" height="10" border="0"></div></td>
								</tr>
							</table>
							<div class="VirtualPrivateURLOut" style="margin:0;padding:0;">&nbsp;</div>
						</div>
					</div>
				</div>

				<div>
~;
}
##-- common {design id}
else {
print qq~
				<div><div>Design ID: <a href="javascript:$templateScript">$trueTN</a></div></div>
				<div><div>Related categories: $losCategories</div></div>
				<div>
					<div>Other ways to share with friends:</div>
					<div style="width:246px;">
						$mySocialNetworkPrint
					</div>
				</div>
~;
}
print qq~
			</div>	
		</td>
	</tr>
</table>
</div>
<div id="panel"></div>
<!-- dont disrupt the flow of data :) -->
<input name="idHash" type="hidden" value="$idHash">
</form>
</div></div></div>
</body>
<script language="javascript" type="text/javascript">
/* wikiboard title object */
if (!(!parent.document.getElementById("WikiBoardBarTitle"))) { 
	mwbt = parent.document.getElementById("WikiBoardBarTitle");
	mwbh = parent.document.getElementById("WikiBoardBarHistory");
	fbsl = parent.document.getElementById("WikiPeeksSlider");
	wbct = parent.document.getElementById("Wiki-Peeks-Content-Source");
	wbcs = parent.document.getElementById("Wiki-Peeks-Content-Search");
}
else if (!(!document.getElementById("WikiBoardBarTitle"))) { 
	mwbt = document.getElementById("WikiBoardBarTitle");
	mwbh = document.getElementById("WikiBoardBarHistory");
	fbsl = document.getElementById("WikiPeeksSlider");
	wbct = document.getElementById("Wiki-Peeks-Content-Source");
	wbcs = document.getElementById("Wiki-Peeks-Content-Search");
}
else { mwbt = 0; wbct = 0; }
var doUnload = function() {
	if (wbct!=0) {
		wbct.innerHTML = loadImage;
	}
};
// only if we exist in a framed document from our controlling parent
if (mwbt!=0) {
	// wikiboard content title [source]
	wbct.innerHTML = '<span style="font-weight:normal;position:relative;left:-4px;top:0px;">- $elTitulo</span>';
	// wikiboard content search
	wbcs.innerHTML = '';
}
</script>
~;

##-- chat support for (questions | service) page
if ($myact eq "question" || $myact eq "service") {

$zopimOnline = "Leave a question or comment, a customer service representative will attend to you shortly.";
$zopimOffline = "We are offline, but if you leave us a message along with your contact details, we will get back to you as soon as possible.";
$zopimAway = "If you leave a question or comment, customer service will be notified and attend to you shortly.";
if ($ISIN ne "") {
	$zopimOnline = "Hello again $First, please leave a question or comment, we will be sure to attend to you shortly. Thank you.";
	$zopimOffline = "Welcome back $First, we apologize but you caught us while we are offline. So, if you leave us a message, we will get back to you as soon as possible.";
	$zopimAway = "Greetings $First, please leave us a question or comment and we will get back to you as soon as possible, thanks.";

	$zopimExtras = "
		if (!!\$zopim && ((!!\$zopim.livechat) && (!!\$zopim.livechat.setName))) { 
			\$zopim.livechat.setName('$First $Last'); 
			\$zopim.livechat.setEmail('$Email');
		}
	";
}

print qq~
<script language="javascript" type="text/javascript">
/*
window.\$zopim||(function(d,s){var z=\$zopim=function(c){z._.push(c)},\$=z.s=d.createElement(s),e=d.getElementsByTagName(s)[0];z.set=function(o){z.set._.push(o)};\$.setAttribute('charset','utf-8');\$.async=!0;z.set._=[];\$.src=('https:'==d.location.protocol?'https://ssl':'http://cdn')+'.zopim.com/?KrB88Hrei4Irm0gATnuNEpZpUbsYuqtT';\$.type='text/java'+s;z.t=+new Date;z._=[];e.parentNode.insertBefore(\$,e)})(document,'script')
*/
</script>
<script language="javascript" type="text/javascript"> 
/*
\$zopim( function() {
	//-hide bubble orange chat bubble
	\$zopim.livechat.bubble.hide();
	\$zopim.livechat.setLanguage('--');
	$zopimExtras
	\$zopim.livechat.button.setPosition('br');
	\$zopim.livechat.window.setTheme('alphacube');
	\$zopim.livechat.window.setColor('#C5E7F4');
	\$zopim.livechat.bubble.setTitle('Questions?');
	\$zopim.livechat.bubble.setText('Click here to chat with us!');
			\$zopim.livechat.setGreetings({
		  'online' : ['Click here to chat', '$zopimOnline'],
		  'offline': ['Leave a message', '$zopimOffline'],
		  'away'   : ['Click here to chat', '$zopimAway']  
	  });
	})
	
	;
*/
</script>
<style>
.meshim_components_button { background:#000000; border:#D1D1D1 1px solid; }
.meshim_components_button:hover { background:#D1D1D1; border:#000000 1px solid; }
</style>

~;
}

print qq~</html>~; 





exit;