#!/usr/bin/perl -s

################################################################
#   Program:    User Email Sending Portal                      #
#   Author:     Luis Gustavo Rodriguez (drlouie)               #
#   Copyright:  (c) 2016 Luis G. Rodriguez                     #
#   Licensing:  MIT License                                    #
##################################################################################
# Permission is hereby granted, free of charge, to any person obtaining a copy   #
# of this software and associated documentation files (the "Software"), to deal  #
# in the Software without restriction, including without limitation the rights   #
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell      #
# copies of the Software, and to permit persons to whom the Software is          #
# furnished to do so, subject to the following conditions:                       #
#                                                                                #
# The above copyright notice and this permission notice shall be included in all #
# copies or substantial portions of the Software.                                #
#                                                                                #
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR     #
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,       #
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE    #
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER         #
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,  #
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  #
# SOFTWARE.                                                                      #
##################################################################################

$perlCompileOS = $^O;
if ($perlCompileOS =~ m/Win/i) {
	$HTTPRoot = 'H:/dvwf/rbsd_IO/vhosts/vsnet/htdocsNEW/';
}
else { $HTTPRoot = '/var/www/vps-net.com/htdocs/'; }

###############
##<-- 2k10 -->##
###############

$|=1;

$noDateParse = 1;
require($HTTPRoot."dateNewest.nsp");

require($HTTPRoot."q.nsp");

## --> Snif cookie, if present test for logged in status
require ($HTTPRoot."cookiesnif.nsp");

##--power functions
require($HTTPRoot."vfunc.nsp");

##-- yes we can still hardcode an admin IP if needed, overwriting log in requirement [but with this, we need to pass ?adi=email@address.com, hence can't list all messages by all users, must log in for that, and only main admin or 555 can accecss]
$AIP = "72.132.117.234";

##--
##-- COMMMUNICATION: FORM  (AJAX ASSISTED)
##--

##-- if logged in, set last login IP to unlocking IP, if not same, must relogin
if ($ISIN ne "") {
	$AIP = $UserIP;
	@pEmail = split(/\[at\]/,$Email);
	$tEm = $pEmail[0] . '@' . $pEmail[1];
	if ($FORM{'adi'} =~ "@") {
		$adi = $FORM{'adi'};
	}
}
else {
	$adi = $FORM{'adi'};
	$tEm = $adi;
}

##--
##-- COMMMUNICATION: FORM  (AJAX ASSISTED)
##--
$mip = $ENV{'REMOTE_ADDR'};
if (($tEm && ($tEm ne 'drlouie@louierd.com' && $tEm ne 'guru@vps-net.com' && $tEm ne 'sales@vps-net.com')) || ($mip && ($mip ne $AIP)) || ($ISIN && !($ISIN ne ""))) {
	#print "<script language=\"Javascript\" type=\"text/javascript\">alert('Error 2150: It is advisable you take note of this error and report it to the site administrator. Thanks. ($mip)');</script>";

	#--> Hack attempt / or bad input
	if (($ISIN && !($ISIN ne "")) || ($mip && ($mip ne $AIP))) {
		$NOPASS = 1;
	}
}

$MessageType = 'User-Outgoing-Message';

## - adi = Admin Email Communications
## - ajax on this one simply spit back message, client won't do anything with results anyway (silent)
if (!$NOPASS){
	$n = $FORM{'VPSNETFirst'};
	$nx = $FORM{'VPSNETLast'};
	$q = $FORM{'VirtualPrivateComments'};
	$email = $FORM{'VirtualPrivateUser'};
	$subject = $FORM{'VirtualPrivateSelectorOutput'};
	if ($ISIN ne "") {
		##-- only admin can send as someone else other than whomever is logged in, everyone must send self addressed
		if (($UserID && (int($UserID) == 555)) || ($mip && ($mip eq $AIP))) {
			$MessageType = 'Admin-Outgoing-Message';

			if (!$adi) {
				$SelfAddressed = 1;
			}
		}
		elsif ($UserID && (int($UserID) > 555)) {
			$SelfAddressed = 1;
		}
	}

	if (!(!$SelfAddressed)) {
		@pEmail = split(/\[at\]/,$Email);
		$adi = $pEmail[0] . '@' . $pEmail[1];

		if (!$FORM{'VirtualPrivateSenderTitle'}) { 
			$senderTitle = $UserTitle;

			##-- if predefined user TitleTag is set, use it as default
			if (!(!$UserHistory)) {
				@HistoryParts = split(/},{/,$UserHistory);
				foreach $HPart (@HistoryParts) {
					if ($HPart =~ m/{TitleTag:/g) {
						##- remove data stack opening bracket: }
						$HPart =~ s/{TitleTag://g;
						##- remove data stack closing bracket: }
						$HPart = $1 if($HPart=~/(.*)}$/);
						$senderTitle = $HPart;
					}
				}
			}
		}
		if (!$FORM{'VirtualPrivateSenderName'}) { $senderName = $First . ' ' . $Last; }
	}
	else {
		$senderTitle = $FORM{'VirtualPrivateSenderTitle'};
		$senderName = $FORM{'VirtualPrivateSenderName'};
	}

	$sender = $adi;
	$em = $email;

	use DBI;
	my $dbh = DBI->connect("DBI:mysql:vpsnetcom","vpsnetcom","YOUR-MySQL-PASSWORD") or die "No data access: <b>VPS-NET</b>\n"; 
	$dbh->{RaiseError} = 1; 

	$EmailFailed = 1;
	$EmailFailed = &checkEmail;

	if ($headerPrinted == 0) { print "Cache-Control: must-revalidate\n\n"; }
	
	## TESTING ONLY ##-- if (!(!$doneit)) { print "<script>alert('$doneit');</script>"; } 
	
	if ($EmailFailed == 0) {
		##-- associative UID = OpenCanvasDesign ID (Cart) [IF EXISTS]
		if ($OpenCanvasDesign  && ($OpenCanvasDesign ne "" && $OpenCanvasDesign ne " ")) { $inUID = $OpenCanvasDesign; }
		
		$q =~ s/\n/<br>/gi;
		$q = "<font size=\"3\" style=\"font-size:13px;line-height:16px;\"><b>$n $nx,</b><br><br>" . $q . "<br><br>Sincerely,<br>$senderName<br>$senderTitle<br><a href=\"mailto:$sender?subject=RE: $subject\">$sender</a></font>";

		##-- escape deadly chars to save message to DB
		$qd = $q;
		$qd =~ s/'/\\'/gi;
		$qd =~ s/"/\\"/gi;
				
		##-- save comments to db, clear the form
		##-- we dont save CartID here, for we are not in cart mode ATM, meaning this comment(question) not coming from cart source (example: aae)
		my $sth = $dbh->prepare("INSERT INTO ConversationLog (LineID, EntryType, MessageContext, CreationDate, UID) VALUES (Null, '$MessageType', '{f:$n},{l:$nx},{e:$email},{sender:$adi},{senderName:$senderName},{sendertitle:$senderTitle}{messagesubject:$subject},{messagebody:$qd}', '$datetime', '$inUID')");
		$sth->execute or die "Unable to execute query\n";
		$sth->finish;

		
		##-- clean it up for email subject
		@mySender = split('<br>',$senderName);

		##<MUST-INTERNET-TEST>##
		## ----------------------->>> SEND AAE EMAIL
		## ----------------------->>> PREPARE VARIABLES FOR OUTER SEND EMAIL PROGRAM
		my $OGSenderIn = "$mySender[0] <$adi>";
		my $OGRecipientIn = "$em ( $n $nx )";
		my $OGsubject = "$subject";

		$myEmailBody = &getEmailHTML(2,1,"","","$OGsubject","<fieldset>$q</fieldset>","");

		##clean up the !\t issue [long line]
		$myEmailBody =~ s/\. /\. \n\r/gi;

		use lib "/usr/local/lib/";
		use Net::SMTP;
		use MIME::Lite;
		
		#my $msgtest = MIME::Lite->new(
		#	From  	 =>$OGSenderIn,
		#	To       =>$OGRecipientIn,
		#	Cc       =>'drlouie@louierd.com',
		#	Subject  =>'Helloooooo, nursey!',
		#	Data     =>"How's it goin', eh?"
		#);
		#$msgtest->send();
		
		my $msg = MIME::Lite->new(
			##-- NOT PASSING From(sender) is set by default to ( World Wide Web Owner <www@2308.x.rootbsd.net> )
			##-- PASSING From(sender) results in GMAIL doing this: (X-Authentication-Warning: 2308.x.rootbsd.net: www set sender to Luis Rodriguez <drlouie@louierd.com> using -f)
				From    =>$OGSenderIn,
				To      =>$OGRecipientIn,
    	 		Subject =>$OGsubject,
		        Type    =>'multipart/related'
	     	);
	   	$msg->attach(Type => 'text/html', Data => $myEmailBody);
		if ($FORM{'coverletter'} eq "on") {
			$msg->attach(Type => 'image/pdf', Path => "../../louierd.com/htdocs/resume/coverletter.pdf", Filename => "Luis-Rodriguez_CoverLetter.pdf");
		}
		if ($FORM{'resume'} eq "on") {
			$msg->attach(Type => 'image/pdf', Path => "../../louierd.com/htdocs/resume/resume.pdf", Filename => "Luis-Rodriguez_Resume.pdf");
		}	
		if ($FORM{'ikmcsharp'} eq "on") {
			$msg->attach(Type => 'image/pdf', Path => "../../louierd.com/htdocs/resume/IKM-C#-Test-Results.pdf", Filename => "Luis-Rodriguez_International-Knowledge-Measurement-C#-Test-Results.pdf");
		}	
		if ($FORM{'loruso'} eq "on") {
			$msg->attach(Type => 'image/pdf', Path => "../../louierd.com/htdocs/drlouie-resume/Sony-Online-Entertainment-Letter-Recommendation-Luis-Rodriguez.doc", Filename => "Luis-Rodriguez_Sony-Online-Entertainment-Letter-of-Recommendation.doc");
		}	
		if ($FORM{'lorsoe'} eq "on") {
			$msg->attach(Type => 'image/pdf', Path => "../../louierd.com/htdocs/drlouie-resume/Universal-Studios-Online-Letter-Recommendation-Luis-Rodriguez-08302000.doc", Filename => "Luis-Rodriguez_Universal-Studios-Online-Letter-of-Recommendation.doc");
		}	
		$msg->send();

		### use Net:SMTP to do the sending (NOT WORKING, FREEZES)
		##--$msg->send('smtp','smtp.secureserver.net');
		

		##-- ajax processed this feedback silently
		print "<center>Message to <strong>$em ( $n $nx )</strong> sent!<br><br><a href=\"?adi=$adi\">Send another using <strong>$adi</strong>?</a></center>";
		exit;
	}
	else {
		$SHOWCONTACT == 1;
		$elTitulo = 'Contact Us';
		$feedback = 'Message Body';
		$cancelAction = 'Cancel';
		$cancelAct = 'Canceling';
		$closeAct = "parent.location.href='https://vps-net.com/newindex.php';";
		$submitAct = 'Submit Message';
		$submitActive = 'Processing';
	
		##-- $processingScript - dynamic form submission script
		$processingScript = "else if (action == 'Processing') { document.VirtualPrivateComment.x.value = '2'; doUnload(); document.getElementById(\"VirtualPrivateActivity\").innerHTML = loadImage; return true; }";
	}
	
	$VPSNETFirst = $FORM{'VPSNETFirst'};
	$VPSNETLast = $FORM{'VPSNETLast'};

	###-- WE ONLY WANT TO FORCE FORM INPUT AFTER SEND SEQUENCE, MEANING SET IT FOR FORM NOT WHILE SENDING, WE SEND FORM INPUT, ENFORCING EMAIL RULES ONLY

	if (!(!$FORM{'resend-exact'}) || !(!$FORM{'resend-similar'})) {
		if (!(!$FORM{'resend-exact'})) {	$MMID = int($FORM{'resend-exact'}); $ResendMessageExact = 1; }
		if (!(!$FORM{'resend-similar'})) {	$MMID = int($FORM{'resend-similar'}); $ResendMessageSimilar = 1; }

		##-- only admin can send any email again
		if (($UserID && (int($UserID) == 555)) || ($mip && ($mip eq $AIP))) {
			$sth = $dbh->prepare("SELECT LineID, MessageContext, CreationDate FROM ConversationLog WHERE LineID = ?");
			$sth->execute($MMID) or die "Unable to execute query\n";
		}
		##-- user can only send their own emails
		else {
			$UserSentTag = "%},{sender:".$adi."},{senderName:%";
			$sth = $dbh->prepare("SELECT LineID, MessageContext, CreationDate FROM ConversationLog WHERE LineID = ? AND MessageContext LIKE ?");
			$sth->execute($MMID, $UserSentTag) or die "Unable to execute query\n";
		}

		while(@row = $sth->fetchrow_array) { 
			$MessageID = $row[0];
			$MessageContext = $row[1];
			$CreationDate = $row[2];
			@MessageParts = split(/},{/,$MessageContext);

			@DefineMessageSubject = split(/}{/,$MessageParts[5]);

			##- recipient stack
			if (!(!$ResendMessageExact)) { 
				##- first
				$MessageParts[0] =~ s/{f://gi;
				$VPSNETFirst = $MessageParts[0];

				##- last
				$MessageParts[1] =~ s/l://gi;
				$VPSNETLast = $MessageParts[1];

				##- email
				$MessageParts[2] =~ s/e://gi;
				$previouslyUsedEmail = $MessageParts[2];

				##--subject
				$DefineMessageSubject[1] =~ s/messagesubject://gi;
				$DefineMessageSubject[1] =~ s/</\&lt;/gi;
				$DefineMessageSubject[1] =~ s/>/\&gt;/gi;
				$messageSubject = $DefineMessageSubject[1];

				$MessageParts[3] =~ s/sender://gi;
				$adi = $MessageParts[3];
				$sender = $adi;

				$MessageParts[4] =~ s/senderName://gi;
				$senderName = $MessageParts[4];
			}

			# already using, reset to use as was using
			$DefineMessageSubject[0] =~ s/sendertitle://gi;
			$DefineMessageSubject[0] =~ s/</\&lt;/gi;
			$DefineMessageSubject[0] =~ s/>/\&gt;/gi;
			$senderTitle = $DefineMessageSubject[0];
			
			$MessageParts[6] =~ s/messagebody://gi;
			$MessageParts[6] =~ s/}//gi;
			@defineOriginalBody = split(/\,<\/b><br><br>/,$MessageParts[6]);
			@defineOriginalBodyFinal = split(/<br><br>Sincerely\,<br>/,$defineOriginalBody[1]);
			$messageBody = $defineOriginalBodyFinal[0];
			$messageBody =~ s/<br>/\n/gi;


		}
		$sth->finish;
	}


	$dbh->disconnect;

}







if (!(!$messageBody)) {
	$Com = $messageBody;
}
elsif (!$Com) {
	$Com = '';
}

$losComments = $Com;
if (!$feedbackScript) {
	$feedbackScript = "javascript:document.VirtualPrivateComment.VPSNETFirst.select();"; 
}


$TAheight = "136px";

## $newCom = &HTMLencodeMyInput($q);










### HEADER WAS, MIGHT HAVE BEEN AN IE ISSUE, DOUBLE-CHECK LATER:
print qq~
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE = 8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Admin Communication Panel (Sending As: $adi)</title>
<link rel="stylesheet" type="text/css" href="/yui.css">
<link rel="stylesheet" type="text/css" href="/javascript-jquery-extension_fancybox-1.3.1.css">
<link rel="stylesheet" type="text/css" href="/jquery.bubblepopup.v2.3.1.css">
<link rel="stylesheet" type="text/css" href="/interface_design_templater.php?q=1&p=CHCSS">
<style type="text/css">
body { overflow-x:hidden;overflow-y:hidden; background:url(/web_design_imagery/accountModel-background-newAccount.png); background-position:bottom right; background-attachment: fixed; background-repeat: no-repeat; }
#panel { display:none; position:absolute;right:0px;top:0px;height:100%;width:100%;z-index:25; overflow-x:hidden;overflow-y:hidden; background:#FFFFFF url(/web_design_imagery/accountModel-background-newAccount.png); background-position:bottom right; background-attachment: fixed; background-repeat: no-repeat; }
#panelContent { display:none; position:absolute;right:0px;top:0px;height:100%;width:100%;z-index:25; overflow-x:hidden;overflow-y:hidden; background:#FFFFFF url(/web_design_imagery/accountModel-background-newAccount.png); background-position:bottom right; background-attachment: fixed; background-repeat: no-repeat; }
#content { visibility:visible;display:visible; }
.VirtualPrivateCommentWrapper { height:210px; }
.VirtualPrivateCommentFormContainer { height:202px; padding-left:15px; padding-right:15px; padding-top:10px; }
.VirtualPrivateCommentPrompt { font-family:tahoma,arial,verdana; font-size:12px; font-weight:bold; color:#000000; }
.VirtualPrivateCommentInstructions { margin-bottom:10px; font-family:verdana,tahoma,arial; font-size:12px; color:#000000; font-weight:normal; }
textarea.VirtualPrivateCommentTextarea { width:100%; height:$TAheight; font-family:Courier New,monospace,serif; font-size:14px; }
#VirtualPrivateUser, #VPSNETFirst, #VPSNETLast, #VPSNETDID, input.VirtualPrivateSelectorOutput { padding:2px; width:65%; font-family:Courier New,monospace,serif; font-size:14px; }
#VPSNETFirst, #VPSNETLast, #VPSNETDID { width:90%; padding:2px; font-size:14px; }
#VPSNETDID { width:55%; text-align:center; }
label.VirtualPrivateCommentLabel { font-size:14px; $feedbackCSS }
#ContactFieldset { }
#ContactFieldset label.VirtualPrivateCommentLabel { font-size:12px; }
input.VirtualPrivateSelectorOutput { font-family:Courier New,monospace,serif; font-size:14px; }
#VirtualPrivateSelectorOutput { padding:0.50%; margin-bottom:2px; }
#VirtualPrivateSelectorPrintout { 
	/*
	margin-bottom:10px;
	padding-left:20px;
	*/
}

.Call-Virtual-Private-VPS-NET { color:#000; }
.Call-Virtual-Private-VPS-NET:hover { color:#3F8FBD; }
.The-Experts-Virtual-Private-VPS-NET { color:#3F8FBD; }
#VirtualPrivateCommentActions {height:27px;}
#VirtualPrivateActivity { padding-right:10px; }
#VirtualPrivateCommentButtons { }
#TemplateCommentAreas { margin-bottom:10px; }
#infoWrap { padding-left:15px; padding-right:15px; padding-bottom:6px; position:relative; top:0px; left:0px; }

#templateModalImage { position:relative; top:20px; left:6px; padding:0px; background: #D5DFE5; width:122px; height:112px; }
#templateModalImage img { border: #D5DFE5 1px solid; }
/* following TOP is driven by previous TOP, just offset by 3px */
.imageShadow { position:relative;top:17px;left:6px; }
/* following TOP is driven by previous TOP, just offset by 3px */
.templateModalData { position:absolute; top:14px; left:146px; padding-left:30px; text-align:left; font:10px verdana,arial,helvetica; }
.templateModalData div { padding-left:7px; background: url(/web_design_imagery/graphical-user-interface-arrow_off.gif) no-repeat 0px 3px; text-align:left; font-weight:normal; }
.templateModalData div.spanned { background-position:0px 6px; }
.templateModalData div div { line-height:12px; margin-top:10px; background: none; }
.templateModalData div div div { padding-left:0px; }
/*contact info*/
.templateModalData div div div { line-height:18px; padding-bottom:6px; }
.templateModalDasher { padding-right:10px; background: none; }

/* 
.templateOptionsData { width:100%; text-align:left; font-weight:normal; }
.templateOptionsData span { font-size:10px; background:#F8F9FA; border: 1px solid #E1E3EC; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; color: #000000; cursor: default; display: block; float: left; height: 19px; margin: 3px 0 3px 3px; padding: 0 2px; position: relative; white-space: nowrap; } 
*/
.ContactOptionItem, .ContactOptionItem:hover { color:#000000; text-decoration:none; margin-left: 4px; }
.delete { margin: 2px 0 -4px 1px; outline: none; }
.miniclose { cursor: pointer; display: inline-block; padding:1px; margin-top: 2px; margin-left: 4px; background-image: url(/web_design_imagery/graphical-user-interface-delete_off.gif); background-repeat: no-repeat; height: 11px; width: 11px; border:1px solid #D5DFE5; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; }
.miniclose:hover { padding:1px; background-image: url(/web_design_imagery/graphical-user-interface-delete_over.gif); border:1px dashed #D5DFE5; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; }

.activeUserData span { font-size:11px; background:transparent; border: none; padding: 1px 3px 1px 3px; color: #555555; cursor: default; display: block; float: left; height: 19px; margin: 3px 0 3px 0; position: relative; white-space: nowrap; }
.activeUserData span:hover { cursor:pointer; border: none; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; padding: 1px 3px 1px 3px; }

span .userarrow, span .userconfig { margin: 0; outline: none; }
.activeUserData span .userarrow { cursor: pointer; display: inline-block; padding:2px; margin-top: 1px; margin-left: 1px; background: url(/web_design_imagery/website_design_communications/arrow-dark.png) -1px 0px no-repeat; height: 9px; width: 9px; border:none; }
.activeUserData span:hover .userarrow { padding:2px; background: url(/web_design_imagery/website_design_communications/arrow-dark-over.png) -1px 0px no-repeat; border:none; }

.activeUserData span .userconfig { cursor: pointer; display: inline-block; padding:0; background: url(/web_design_imagery/website_design_communications/gear_dark.png) 0 1px no-repeat; height:17px; width:16px; border:none; }
.activeUserData span:hover .userconfig { background: url(/web_design_imagery/website_design_communications/gear_dark_dropdown.png) 0 1px no-repeat; border:none; height:17px; width:16px; }
.activeUserData span.config { padding: 1px 3px 1px 3px; }
.activeUserData span.config:hover { border:0; padding: 1px 3px 1px 3px; }

#CommunicationsLogin { border:0;margin:0;padding: 3px 2px 2px 4px; }

/* old clearfix *//* .clearfix::after { visibility: hidden; clear: both; display: block; line-height: 0; height: 0; font-size: 0; content: "."; } */
/* new clearfix */
.clearfix:after { visibility: hidden; display: block; font-size: 0; content: " "; clear: both; height: 0; }
* html .clearfix             { zoom: 1; } /* IE6 */
*:first-child+html .clearfix { zoom: 1; } /* IE7 */

/*Virtual Private Servers and Networks Communications Panel*/
#VirtualPrivateServersURLs { width:90%;margin:0;padding:0;cursor:pointer; }
#VirtualPrivateURLs, #VirtualPrivateURL { font-family:arial,tahoma,helvetica; font-size:9px; line-height:12px; }
#VirtualPrivateURLs { color:#000000; }
#VirtualPrivateURLs:hover { color:#3F8FBD; cursor:pointer; }
#VirtualPrivateURL { padding:3px;padding-top:2px;width:100%;cursor:pointer; }
#MoreVirtualPrivateNetworks { width:93%; margin:0; padding:0; padding-right:7%; }
#CopyVirtualPrivateServers {  margin-left:10px; float:left; text-align:left; }
#OtherVirtualPrivateServersLinks { margin-right:10px; float:right; text-align:right; }

span.DefaultOptionsMenu { border:#FFFFFF 1px dashed; background:none; }

#chat-sales { padding-bottom:10px; }

#comments-form-message { padding: 5px 5px 5px 30px; width:auto; display: block; text-align:left; border: 1px dashed #AAB19E; margin:0; color:#000000; font-size: 11px; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; }
#comments-form-message.comments-form-message-error { border: 1px dashed #E98D8D; }
.comments-form-message-error {background: #F5CCCC url(/web_design_imagery/website_design_communications/icon_error.png) no-repeat 6px 3px; }
.comments-form-message-info {background: #F9F9F9 url(/web_design_imagery/website_design_communications/icon_info.png) no-repeat 6px 3px; }
.comments-form-message-optin {background: #F9F9F9 url(/web_design_imagery/website_design_communications/icon_email.png) no-repeat 6px 3px; }
.comments-form-message-time {background: #F9F9F9 url(/web_design_imagery/website_design_communications/icon_time.png) no-repeat 6px 3px; }
.comments-form-message-contact-added {background: #F9F9F9 url(/web_design_imagery/website_design_communications/virtual-private-contact-added.png) no-repeat 6px 3px; }
.admincomtitle{position:absolute;left:0;top:0;padding:10px;font-size:17px;font-weight:bold;}
.admincomsubtitle{font-style:italic;font-size:10px;font-weight:normal;}
</style>
<script language="javascript" type="text/javascript" src="/cross_browser_javascripts/javascript-library-jquery-1.4.2.min.js"></script>
<script language="javascript" type="text/javascript" src="/cross_browser_javascripts/javascript-jquery-extension_bubblepopup.v2.3.1.min.js"></script>
<script language="javascript" type="text/javascript" src="/cross_browser_javascripts/javascript-yui-extension-container_core-min.js"></script>
<script language="javascript" type="text/javascript" src="/cross_browser_javascripts/javascript-yui-extension_connection-min.js"></script>
<script language="javascript" type="text/javascript" src="/interface_design_templater.php?q=1&p=CHS"></script>
<script>
/* document/source variables */
	//var QueryString = '$ENV{'QUERY_STRING'}';
	//var titleLink = '<span style="position:relative;top:2px;left:0px;"><a href="javascript:addBookmark(\\\''+appLoc+'?'+QueryString+'\\\', \\\'WikiPeeks ('+source+') '+myTitle+'\\\');" onMouseOver="iHover(this.firstChild,1);" onMouseOut="iHover(this.firstChild,0);" title="Add to Favorites: ('+source+') '+myTitle+'"><img src="/web_design_imagery/WikiBarLink-off.gif" width="14" height="14" border="0" alt="Add to Favorites: ('+source+') '+myTitle+'" name="WikiBarLink" id="WikiBarLink"></a><span> &nbsp;</span>';
	//if (myTitle == '') { titleLink = ''; }
	var loadImage = '<span style="position:relative;top:2px;left:0px;" title="Loading, please wait..."><img src="/web_design_imagery/loadCircle.gif" width="18" height="15" border="0" alt="Loading, please wait..."></span>';
	var hasClicked = 0;
	var runClick = function(quien,action) {
		hasClicked = 1;
		// none is associated with final run, meaning buttons not available, hidden+disabled
		if (quien!='none') { 
			quien.value = action; 
			//document.VirtualPrivateComment.CanvasSubmit.disabled = 1;
			//document.VirtualPrivateComment.CanvasCancel.disabled = 1;
		}

		if (action == 'Canceling' || action == 'Virtual-Private-Wave') {
			$closeAct
		}
$processingScript
$closingScript
};

\$(document).ready(function() {
	if (!(!parent.document.getElementById("Document-Title"))) {
		parent.document.getElementById("Document-Title").innerHTML = '$whichDocTitle';
	}
	else if (!(!document.getElementById("Document-Title"))) {
		document.getElementById("Document-Title").innerHTML = '$whichDocTitle';
	}
});

~;

##-- for ajax form submission calls
if ($myact eq "question" || $myact eq "service" || $myact eq "share" || $myact eq "ContactVirtualPrivate") {
	print qq~
		var ec = 0;
		var VirtualPrivateCommentActions = '';
		var stcf = function() {
			// save default actions to revert to
			if (VirtualPrivateCommentActions == '') { VirtualPrivateCommentActions = \$('#VirtualPrivateCommentActions').html(); }
			var formObject = document.getElementById('VirtualPrivateComment');
			YAHOO.util.Connect.setForm(formObject);

			doUnload();
			document.getElementById("VirtualPrivateActivity").innerHTML = loadImage;
			var callback = {
				success: function(o) {
					if(o.responseText !== undefined) {
						// another+selection | message+invalid|short
						if ((o.responseText.indexOf('selection') != -1 && o.responseText.indexOf('another') != -1) || (o.responseText.indexOf('message') != -1 && (o.responseText.indexOf('invalid') != -1 || o.responseText.indexOf('short') != -1))) {
							actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>');
							if (o.responseText.indexOf('selection') != -1) { document.VirtualPrivateComment.VirtualPrivateSelectorOutput.focus(); }
							else { document.VirtualPrivateComment.VirtualPrivateComments.focus(); }
						}
						else {
							if (o.responseText.indexOf('will be sent using') != -1 || o.responseText.indexOf('will be submitted using') != -1 || o.responseText.indexOf('will be saved using') != -1) {
								cualActivity = 'submit';
								if (o.responseText.indexOf('will be submitted using') != -1) {
									pueResponse = o.responseText.replace('Canvas will be submitted using <b>','').replace('</b>','');
								}
								else if(o.responseText.indexOf('will be saved using') != -1) {
									pueResponse = o.responseText.replace('Canvas will be saved using <b>','').replace('</b>','');
									cualActivity = 'save';
								}
								else {
									pueResponse = o.responseText.replace('Message will be sent using <b>','').replace('</b>','');
								}
								actionMessage('<div id="comments-form-message" class="comments-form-message-info">'+o.responseText+'</div>');
								\$("#UserSettings").html('');
								\$("#UserSettings").html('<span style="position:relative;top:-4px;right:-3px;" onClick="javascript:ec=2;if (hasClicked == 0) { return runClick(document.VirtualPrivateComment.CanvasSubmit,submitActive); }"><span style="padding:0 4px 3px 0;">'+pueResponse+'</span><a class=\"userconfig\"></a></span>');
								\$("#CommunicationsLogin").hide();
								submitAct = 'Yes, '+cualActivity+' it';
								// set the consent to positive [for use by stcf]
								ec = 1;
								// cancel being the only alternative
								cancelAct = 'Nevermind, cancel';
							}
							else if (o.responseText.indexOf('will need your contact information') != -1) {
								\$('.UserStatus').HideAllBubblePopups();
								\$("#UserSettings").hide();
								\$("#CommunicationsLogin").show();
								//4500
								actiontimer = 2800;
								actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>');
							}
							else if (o.responseText.indexOf('TryAgain!') != -1) {
								actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>');
							}
							else if (o.responseText.indexOf('Account Used') != -1 || o.responseText.indexOf('Contact Info Used') != -1) {
								if (o.responseText.indexOf('by OpenCanvas') != -1) {
									if (o.responseText.indexOf('to Save') != -1) {
										myResponse = 'Canvas was successfully saved, check recipient email to confirm.';
										actiontimer = 2900;
									}
									else {
										myResponse = 'Canvas was successfully submitted, we will get back to you shortly.';
										actiontimer = 3000;
									}
								}
								else {
									myResponse = 'Message successfully sent, we thank you for your correspondence.';
									//set actiontimer to 2700 truly final process, close window
									actiontimer = 2700;
								}
								actionMessage('<div id="comments-form-message" class="comments-form-message-info">'+myResponse+'</div>');
							}
							else if (o.responseText.indexOf('Good!') != -1) {
								actiontimer = 2600;
								o.responseText = o.responseText.replace('Good!','');
								actionMessage('<div id="comments-form-message" class="comments-form-message-contact-added">'+o.responseText+'</div>');
								document.VirtualPrivateComment.VirtualPrivateComments.value = '';
							}
							// error if matches nothing
							else { actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>'); }
						}
						//-- reset viewport title
						if (!(!wbct) && (wbct!=0)) { wbct.innerHTML = '<span style="font-weight:normal;position:relative;left:-4px;top:0px;">- $elTitulo</span>'; }
					}
					//-- anything else, including uncaught errors, are by-passed [end-less loop for user, no errors, no verification just a click through loop]
					else { enableCom(); }
				},
				failure: function(o) {
					enableCom();
					actionMessage('<div id="comments-form-message" class="comments-form-message-error">'+o.responseText+'</div>');
					//-- reset viewport title
					if (!(!wbct) && (wbct!=0)) {
						wbct.innerHTML = '<span style="font-weight:normal;position:relative;left:-4px;top:0px;">- Request Error</span>';
					}
				}
			};
	        window.setTimeout(function() {
    	        var sUrl = "/customer-communication-panel.htm";
        	    // sample: '$myact=' + ((Dom.get('filter').checked) ? 'yes' : 'no') + '&whatever=' + encodeURIComponent(VirtualPrivateComment.get('SubjectSelection').value);
        	    // var data = 't=$template&v=$version&$myact='+encodeURIComponent(document.VirtualPrivateComment.$myact.value)+'&ss=' + encodeURIComponent(document.VirtualPrivateComment.SubjectSelection.value)+'&vps=' + encodeURIComponent(document.VirtualPrivateComment.VirtualPrivateComments.value)+'';
            	var request = YAHOO.util.Connect.asyncRequest('POST', sUrl, callback, 'ocso=1&ec='+ec+'');
        	}, 200);
		};
		
		var actiontimer = 5000;
		var refreshActions = function(callback) {
	        window.setTimeout(function() {
				\$('#comments-form-message').fadeTo('fast','0.00',function(){
					\$('#VirtualPrivateCommentActions').fadeTo('fast','0.00',function(){
						\$(this).html(VirtualPrivateCommentActions).fadeTo('fast','0.00', function(){
							// otherwise is default 5000 timer, enableCom
							if (actiontimer == 5000 || actiontimer == 100) {
								actiontimer = 5000;
								enableCom();
								\$(this).fadeTo('slow','1.00', callback);
							}
       						//final timer at 2700, triggers new actions
							// canvas: 2900 = saved | 3000 = submitted
							else if (actiontimer == 2700 || actiontimer == 2900 || actiontimer == 3000) {
								\$(this).fadeTo('fast','0.00', function() {
									whichMensage = 'We will now be closing this form, thanks again for your correspondence.';
									if (actiontimer == 2900 || actiontimer == 3000) { whichMensage = 'We will now be closing this form, thanks again for using OpenCanvas.'; }
									\$(this).html('<div id="comments-form-message" class="comments-form-message">'+whichMensage+'</div>');
									\$(this).fadeTo('slow','1.00', function() {
										\$(this).fadeTo(2500,'0.00', function() {
											//reset action timer
											
											if (actiontimer == 2900) {
												if (!(!parent.activeTemplates)) { 
													parent.CanvasSaved();
												}
											}
											if (actiontimer == 3000) {
												if (!(!parent.activeTemplates)) { 
													parent.CanvasSubmitted();
												}
											}
											actiontimer = 5000;
											runClick('none','Virtual-Private-Wave');
										});
									});
								});
							}
       						//show correspondence form
							else if (actiontimer == 2600) {
								\$(this).fadeTo('fast','0.00', function() {
									\$(this).html('<div id="comments-form-message" class="comments-form-message-info">Feel free to continue sharing, we love showing off our work!</div>');
									\$(this).fadeTo('slow','1.00', function() {
										\$(this).fadeTo(2500,'0.00', function() {
			
											correspondenceForm('$netAgent');

											submitAct = submitActDEFAULT;
											submitActive = submitActiveDEFAULT;
											cancelAct = cancelActDEFAULT;


											// yep reset buttons, running 100 timer
											actiontimer = 100;
											refreshActions();
										});
									});
								});
							}
       						// contact info timer at 2800, triggers new actions
							else if (actiontimer == 2800) {
								\$(this).fadeTo('fast','0.00', function() {
									\$(this).html('<div id="comments-form-message" class="comments-form-message-info">Please fill out the following contact form in its entirety to continue.</div>');
									\$(this).fadeTo('slow','1.00', function() {
										\$(this).fadeTo(2500,'0.00', function() {
											//set ec [EmailConsent] to 3, our next process in line
											ec = 3;
											//reset action timer
											contactInformationForm('VPSNETFirst','$netAgent');
											// yep reset buttons, running 100 timer
											actiontimer = 100;
											refreshActions();
										});
									});
								});
							}
						});
					});
				});
        	}, actiontimer);
		};
		var actionMessage = function(mymessage) {

			// which one was flagged as bad
			if (mymessage.indexOf("TryAgain!") != -1) {
				mymessage = mymessage.replace('TryAgain!','');
				if (mymessage.indexOf('first name') != -1) { document.VirtualPrivateComment["VPSNETFirst"].select(); }
				else if (mymessage.indexOf('last name') != -1) { document.VirtualPrivateComment["VPSNETLast"].select(); }
				else if (mymessage.indexOf('email') != -1) { document.VirtualPrivateComment["VPSNETEmail"].select(); }
			}

			if (VirtualPrivateCommentActions == '') { VirtualPrivateCommentActions = \$('#VirtualPrivateCommentActions').html(); }
			\$('#VirtualPrivateCommentActions').fadeTo('fast','0.00',function(){
				\$(this).html(mymessage).fadeTo('slow','1.00',function(){
    				refreshActions(function() {
						//okay now what
    				});
				});
			});
		};

		var submitActDEFAULT = '$submitAct';
		var submitActiveDEFAULT = '$submitActive';
		var cancelActDEFAULT = '$cancelAction';
		var submitAct = submitActDEFAULT;
		var submitActive = submitActiveDEFAULT;
		var cancelAct = cancelActDEFAULT;
		var enableCom = function() {
			document.getElementById("VirtualPrivateActivity").innerHTML = '';
			document.VirtualPrivateComment.CanvasSubmit.value = submitAct;
			document.VirtualPrivateComment.CanvasCancel.value = cancelAct;
			document.VirtualPrivateComment.CanvasSubmit.disabled = 0;
			document.VirtualPrivateComment.CanvasCancel.disabled = 0;
			hasClicked = 0;
		};
		
		var contactInformationForm = function(imsel,msie) {
			/*msie 8 AND LOWER has trouble with fading, revert to show/hide only */
			if (msie.indexOf("MSIE 5.") != -1 || msie.indexOf("MSIE 6.") != -1 || msie.indexOf("MSIE 7.") != -1 || msie.indexOf("MSIE 8.") != -1) {
				\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter').hide();
				\$('#ContactFieldset').show();
				document.VirtualPrivateComment[imsel].select();
			}
			else {
				\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter').fadeTo('slow','0.00',function() {
					\$(this).css('display','none');
					\$('#ContactFieldset').fadeTo('fast','0.00',function(){
						//\$('#VirtualPrivateCommentActions').attr('align','center');
						\$(this).css('display','block').fadeTo('slow','1.00');
						document.VirtualPrivateComment[imsel].select();
					});
				});
			}
		};
		
		var correspondenceForm = function (msie) {
			/*msie 8 AND LOWER has trouble with fading, revert to show/hide only */
			if (msie.indexOf("MSIE 5.") != -1 || msie.indexOf("MSIE 6.") != -1 || msie.indexOf("MSIE 7.") != -1 || msie.indexOf("MSIE 8.") != -1) {
				\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter, #VirtualPrivateCommentActions').show();
				\$('#ContactFieldset').hide();
			}
			else {
				if (!(!\$('#ContactFieldset'))) {
					\$('#ContactFieldset').fadeTo('slow','0.00',function() {
						\$(this).css('display','none');
						\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter, #VirtualPrivateCommentActions').fadeTo('fast','0.00',function(){
							\$(this).css('display','block').fadeTo('slow','1.00');
						});
					});
				}
				else {
					\$(this).css('display','none');
					\$('#VisualSwapOne, #VisualSwapTwo, #VirtualPrivateSubjectMatter, #VirtualPrivateCommentActions').fadeTo('fast','0.00',function(){
						\$(this).css('display','block').fadeTo('slow','1.00');
					});
				}
			}
			// [WORKS PERFECTLY AS IT SITS] was thinking about switching process back to ec=1, step one, but really no need, for now
			// ec = 2;
			//\$(this).fadeTo('slow','1.00', callback);
		}
		
		var panelView = function(content) {
			\$('#content').fadeTo('slow','0.00',function() {
				\$('#panel').css('display','block').fadeTo('slow','1.00',function(){
					\$(this).html('<div id="panelContent">'+content+'</div>').css('display','block').fadeTo('slow','1.00');
				});
			});
		};
		
	~;
}


	##- $defaultOptionsOutput = "Selecting last item populates list with more options.";
	if ($myact && ($myact eq "question" || $myact eq "service" || $myact eq "share")) {


		## question and service
		if ($myact eq "share") {
			push(@selectors,"Share this website");
		}
		else {
			push(@selectors,"General Inquiry");
			##-- only if logged in do we give them TS and CS options (checked by cookiesnif.nsp)
			if ($ISIN ne "") {
				push(@selectors,"Technical Support");
				push(@selectors,"Customer Service");
			}
		}

		if ($myact eq "question" || $myact eq "share") {
			if (($template =~ m/ocv/i) && length($template) > 5 && int($CualOC) > 0) {
				$open_canvas_package = "$losCanvasPacks[$CualOC]";
				push(@specificSelectors,"- OC".$CualOC." (".$losCanvasPacks[$CualOC].")");
			}
			push(@specificSelectors,"- Design ID: $trueTN");
			push(@specificSelectors,"- Canvas ID: $idHash");
		}
		
		if ($myact eq "service" || $myact eq "share") {
			push(@specificSelectors,"- OpenCanvas (Interactive Web Design Experience)");
			push(@specificSelectors,"- SEM (Search Engine Marketing)");
			push(@specificSelectors,"- SEO (Search Engine Optimization)");
			if ($myact eq "share") {
				##push(@specificSelectors,"- Techie (Technical Tutorials & Resources)");
				push(@specificSelectors,"- Tools (Website Tools & Widgets)");
			}
			##push(@specificSelectors,"- MITe (Master Information Technology Engineering)");
			push(@specificSelectors,"- WikiPeeks (Internet Wiki Plug-In for Websites)");
		}

		if (@specificSelectors) {

			if ($myact eq "share") {
				push(@selectors,"Specific Products, Services or Content...");
			}
			else {
				push(@selectors,"Specific Products or Services...");
			}
			$sselor = join('","',@specificSelectors);
		}

		print qq~var specificSelectors = new Array("$sselor");~;
		if (@selectors) {
			$selor = join('","',@selectors);
			print qq~var selectors = new Array("$selor");~;
		}


		##-- how many multiples can we select, term(s)
		##-- max selectable is always 4, but since common lists only contain 3 sub-items, we just generalize its term
		$whatMultiple = 'multiple';
		##-- default select list layout
		##-- only if logged in do we give them TS and CS options (checked by cookiesnif.nsp)
		if ($ISIN ne "") {
			##-- $losSelectorsMain items that reset our list, back to default
			$losSelectorsMain = "who == '$selectors[0]' || who == '$selectors[1]' || who == '$selectors[2]'";
			##-- $elSelectorItem is the list item that will trigger a repopulation action
			$elSelectorItem = $selectors[3];
		}
		##-- no CS or TS
		else {
			$losSelectorsMain = "who == '$selectors[0]'";
			$elSelectorItem = $selectors[1];
		}


		##-- SAME as no CS or TS, but we leave it here to make it easier to understand future-tense
		if ($myact eq "share") { 
			##-- max selectable is always 4, this sub-list contains more than 4 items, let user know how many they can select verbally
			$whatMultiple = 'up to four(4)';
			$losSelectorsMain = "who == '$selectors[0]'";
			$elSelectorItem = $selectors[1]; 
		}

		##-- all default selectors
		$losSelectors = "$losSelectorsMain || who == '$elSelectorItem'";
		$defaultOptionsOutput = "For more options select: <i>".$elSelectorItem."</i>";
	}

print qq~

var whosChanged = '';
var numberChanged = 0;
var removeFromChanged = function(who) {
	if (whosChanged.indexOf(" "+who+"") != -1) {
		whosChanged = whosChanged.replace(" "+who+"","");
		numberChanged--;
		document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = '';
		for (var i=0; i<specificSelectors.length; i++) {
			mywho = ""+specificSelectors[i]+"";
			mywho = mywho.replace('- ','');
			if (whosChanged.indexOf(""+mywho+"") != -1) {
				whoC = mywho;
				if (whoC.indexOf(" (") != -1) { who2 = whoC.split(" ("); whoC = who2[0]; }
				whoC = whoC.replace('Design ID: ','');
				whoC = whoC.replace('Canvas ID: ','');
				document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = document.getElementById("VirtualPrivateSelectorPrintout").innerHTML + '<span><a id="'+mywho+'" title="'+mywho+'" class="ContactOptionItem"><nobr>'+whoC+'<a class="miniclose delete" title="Remove '+mywho+'" onClick="removeFromChanged(\\''+mywho+'\\');"></a></nobr></span>';
			}
		}
		document.VirtualPrivateComment.SubjectSelection.value = whosChanged;
	}
	// if no 'other/specific' item selections, revert back to default select list state and action message
	if (numberChanged == 0) {
		document.VirtualPrivateComment.SubjectSelection.value = '';
		reparseList('$selectors[0]');
		document.getElementById("VirtualPrivateSelectorPrintout").innerHTML = ''+defaultOptionsOutput+'';
	}
	// at this point we can change share URL according to 1st item chosen, anything else reverts back to default URL
	if (numberChanged >= 1) {
		setShareURL(whosChanged);
	}
	else {
		setShareURL(defaultOption);
	}
	
};



// all communications/forms get caughtEscape functionality
var caughtEscape = 0;
var imFocused = '';
function checkEscape(e,val) {
	if(!e) var e = window.event;
	if (e.which) { key = e.which; }
	else if (e.keyCode) { key = e.keyCode; }
	var eValue = val.value;
	if (caughtEscape == 0 && key == 27) {
		imFocused = \$("*:focus").attr("id");
		caughtEscape = 1;
		\$("#processKiller").show('fast');
		\$("#YesClose").focus();
	}
}

function runEscape(way) {
	if (way == 'No') {
		caughtEscape = 0;
		\$("#processKiller").hide('fast');
		// focus on last element being focused on to begin with
		\$("#"+imFocused+"").focus();
		imFocused = '';
	}
	else {
		parent.location.href='https://vps-net.com/newindex.php';
	}
}

</script>
</head>
<body style="margin:0;padding:0;" onbeforeunload="doUnload();" onload="$feedbackScript">
<div id="processKiller"  style="display:none;cursor:wait;z-index:1000000;width:100%;position:absolute;right:0px;top:0px;visibility:$processLoadVisibility;background-color:#FFFFFF;width:100%;height:100%;overflow:hidden;">
			<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
				<tr valign="middle"><td width="100%">
					<table width="100%" border="0" cellpadding="0" cellspacing="0">
						<tr style="cursor:wait;"><td width="100%" bgcolor="#C9CDDF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);" title="Virtual Private Servers - VPS"><img src="/web_design_imagery/spacie.gif" height="1" width="1" border="0" alt="Virtual Private Servers - VPS"></div></td></tr>
						<tr style="cursor:wait;"><td width="100%" bgcolor="#FFFFFF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);" title="Virtual Private Networks - VPN"><img src="/web_design_imagery/spacie.gif" height="1" width="1" border="0" alt="Virtual Private Networks - VPN"></div></td></tr>
						<tr style="cursor:wait;"><td width="100%" align="center" id="net" style="color:#333333;font-family:verdana,arial;font-size:12px;line-height:20px;" title=". . . OpenCanvas by VPS-NET, coming soon . . ." valign="top"><div style="padding:20px;">Close $elTitulo?</div></td></tr>
						<tr>
							<td width="100%" align="center" style="padding: 0 0px 20px 0px;"><form onSubmit="return false;"><button id="YesClose" onClick="return runEscape('Yes');">Yes</button><button onClick="return runEscape('No');">No</button></form></td>
						</tr>
						<tr style="cursor:wait;"><td width="100%" bgcolor="#FFFFFF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);" title="Application Programming Interface - API"><img src="/web_design_imagery/spacie.gif" height="1" width="1" border="0" alt="Application Programming Interface - API"></div></td></tr>
						<tr style="cursor:wait;"><td width="100%" bgcolor="#C9CDDF"><div style="width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);" title="Search Engine Optimization - SEO"><img src="/web_design_imagery/spacie.gif" height="1" width="1" border="0" alt="Search Engine Optimization - SEO"></div></td></tr>
					</table>
				</td></tr>
			</table>
</div>
<a name="topmost" id="topmost"></a>
<div class="admincomtitle">Admin Communication Panel (Sending As: $adi)</div>
$userStatus
<div>
<div style="text-align:left;padding:40px;">
<div id="content" $myTriggerKeyDown="return checkEscape(event, this);" onKeyUp="return checkEscape(event, this);">
~;

print qq~
<form name="VirtualPrivateComment" id="VirtualPrivateComment" method="post" action="?" onSubmit="if (hasClicked == 0) { return runClick(document.VirtualPrivateComment.CanvasSubmit,'$submitActive'); }">
<input name="adi" type="hidden" value="$adi">

<div class="VirtualPrivateCommentWrapper">
	<div class="VirtualPrivateCommentFormContainer">
~;



$theX = '<input name="x" type="hidden" value="0">';


###--- RECIPIENT CONTACT INFORMATION
print qq~
<div id="ContactFieldset">
<div style="padding-bottom:11px;">
<fieldset style="margin:0;padding:0;display:block;font-size:14px;width:100%;-moz-border-radius:3px; -webkit-border-radius:3px; border-radius:3px;">
	<legend style="padding:0 10px 0 10px;">Recipient Contact Information</legend>
	<div style="padding:10px;">
		<div style="padding-left:15px;">
			<div style="float:left;width:35%;">
				<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VPSNETFirst" id="label_VPSNETFirst">First Name</label></div>
				<div style="padding-bottom:12px;"><input type="text" name="VPSNETFirst" id="VPSNETFirst" value="$VPSNETFirst" class="VirtualPrivateUser" tabindex="1" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);"></div>
			</div>
			<div style="float:left;width:65%;">
				<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VPSNETLast" id="label_VPSNETLast">Last Name</label></div>
				<div style="padding-bottom:12px;"><input type="text" name="VPSNETLast" id="VPSNETLast" value="$VPSNETLast" class="VirtualPrivateUser" tabindex="2" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);"></div>
			</div>
		</div>

		<div id="ContactSwapTwo">
~;

$subjectTitle = 'Recipient Email Address:';
print qq~
			<center>
				<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VirtualPrivateUser" id="label_VirtualPrivateUser">$subjectTitle</label></div>
				<div id="VirtualPrivateSelectorOutputWrap" style="padding-bottom:20px;"><input type="text" name="VirtualPrivateUser" value="$previouslyUsedEmail" id="VirtualPrivateUser" class="VirtualPrivateUser" tabindex="3" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);"></div>
			</center>
~;


print qq~
		</div>
	</div>
</fieldset>
</div>
</div>
~;




###--- MESSAGE SUBJECT, SENDER AND SENDER TITLE
	print qq~
	<div id="VirtualPrivateSubjectMatter">
		<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VirtualPrivateSelectorOutput" id="label_VirtualPrivateSelectorOutput">Subject</label></div>
		<div id="VirtualPrivateSelectorOutputWrap">
			<input type="text" name="VirtualPrivateSelectorOutput" id="VirtualPrivateSelectorOutput" value="$messageSubject" class="VirtualPrivateSelectorOutput" tabindex="4" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);">
		</div>
		<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VirtualPrivateSenderName" id="label_VirtualPrivateSenderName">Sender Name (First and/or Last Name)</label></div>
		<div id="VirtualPrivateSelectorOutputWrap">
			<input type="text" name="VirtualPrivateSenderName" id="VirtualPrivateSenderName" value="$senderName" class="VirtualPrivateSelectorOutput" tabindex="5" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);">
		</div>
		<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VirtualPrivateSenderTitle" id="label_VirtualPrivateSenderTitle">Sender Title (Official Title) [HTML]</label></div>
		<div id="VirtualPrivateSelectorOutputWrap">
			<input type="text" name="VirtualPrivateSenderTitle" id="VirtualPrivateSenderTitle" value="$senderTitle" class="VirtualPrivateSelectorOutput" tabindex="6" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);">
		</div>
		<div id="VirtualPrivateSelectorPrintout" class="templateOptionsData clearfix"></div>

	</div>
	~;

	
	
	
	
	
	
	
	
	
	
	
	
	

if (!$losComments) { $losComments = ""; }


###--- MESSAGE BODY
print qq~
	<div id="VisualSwapOne">
		<div class="VirtualPrivateCommentInstructions"><label class="VirtualPrivateCommentLabel" for="VirtualPrivateComments" id="label_VirtualPrivateComments">$feedback [HTML]</label></div>
		<div id="TemplateCommentAreas"><textarea name="VirtualPrivateComments" id="VirtualPrivateComments" class="VirtualPrivateCommentTextarea" tabindex="7" onFocus="formLabelFlipper(this,1);" onBlur="formLabelFlipper(this,0);">$losComments</textarea>$theX</div>
	</div>
~;






print qq~
		<div id="VirtualPrivateCommentActions" align="right"><span id="VirtualPrivateActivity"></span><span>Attach: Cover Letter <input type="checkbox" name="coverletter"> | Resume <input type="checkbox" name="resume"> | IKM C# <input type="checkbox" name="ikmcsharp"> | LoR-USO <input type="checkbox" name="loruso"> | LoR-SOE <input type="checkbox" name="lorsoe">&nbsp;&nbsp;</span><span id="VirtualPrivateCommentButtons"><input type="submit" tabindex="8" class="canvasButtons" name="CanvasSubmit" id="CanvasSubmit" style="padding:3px;padding-left:10px;padding-right:10px;font-size:12px;font-weight:bold;" value="$submitAct" /><input type="button" onClick="javascript:return runClick(document.VirtualPrivateComment.CanvasCancel,'$cancelAct');" tabindex="9" class="canvasButtons" name="CanvasCancel" style="padding:3px;padding-left:8px;padding-right:8px;font-size:12px;" value="$cancelAction"/></span></div>
	</div>
</div>
<div id="infoWrap">

</div>
<div id="panel"></div>
</form>
</div></div></div>
</body>
<script language="javascript" type="text/javascript">
/* wikiboard title object */
if (!(!parent.document.getElementById("WikiBoardBarTitle"))) { 
	mwbt = parent.document.getElementById("WikiBoardBarTitle");
	mwbh = parent.document.getElementById("WikiBoardBarHistory");
	fbsl = parent.document.getElementById("WikiPeeksSlider");
	wbct = parent.document.getElementById("Wiki-Peeks-Content-Source");
	wbcs = parent.document.getElementById("Wiki-Peeks-Content-Search");
}
else if (!(!document.getElementById("WikiBoardBarTitle"))) { 
	mwbt = document.getElementById("WikiBoardBarTitle");
	mwbh = document.getElementById("WikiBoardBarHistory");
	fbsl = document.getElementById("WikiPeeksSlider");
	wbct = document.getElementById("Wiki-Peeks-Content-Source");
	wbcs = document.getElementById("Wiki-Peeks-Content-Search");
}
else { mwbt = 0; wbct = 0; }
var doUnload = function() {
	if (wbct!=0) {
		wbct.innerHTML = loadImage;
	}
};
// only if we exist in a framed document from our controlling parent
if (mwbt!=0) {
	// wikiboard content title [source]
	wbct.innerHTML = '<span style="font-weight:normal;position:relative;left:-4px;top:0px;">- $elTitulo</span>';
	// wikiboard content search
	wbcs.innerHTML = '';
}
</script>
~;


print qq~</html>~; 





exit;









